<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SyncVent — Ventilação Mecânica (educacional)</title>

  <style>
    :root{
      --bg:#f6f8ff;
      --panel:#ffffff;
      --panel2:#f2f5ff;
      --text:#0b1220;
      --muted:#41516b;
      --line:#d9e2f3;
      --chip:#eef3ff;
      --blue:#2563eb;
      --blue2:#1d4ed8;
      --good:#16a34a;
      --warn:#f59e0b;
      --bad:#ef4444;
      --shadow: 0 18px 45px rgba(18,36,80,.12);
      --radius:16px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }

    html,body{ height:100%; }
    body{
      margin:0;
      font-family: var(--sans);
      background: var(--bg);
      color: var(--text);
    }

    /* Splash */
    #splash{
      position: fixed;
      inset: 0;
      background: radial-gradient(800px 500px at 20% 10%, rgba(37,99,235,.20), transparent 60%),
                  radial-gradient(900px 600px at 85% 20%, rgba(37,99,235,.12), transparent 55%),
                  var(--bg);
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:9999;
      transition: opacity .35s ease;
    }
    #splash.hide{ opacity:0; pointer-events:none; }

    .splashCard{
      width:min(860px, 92vw);
      border:1px solid var(--line);
      border-radius: calc(var(--radius) + 10px);
      background: linear-gradient(180deg, rgba(37,99,235,.06), rgba(255,255,255,.70));
      box-shadow: var(--shadow);
      padding: 26px 22px;
    }
    .splashTop{
      display:flex; gap:16px; align-items:center; justify-content:space-between; flex-wrap:wrap;
    }
    .brand{ display:flex; gap:12px; align-items:center; }
    .logo{
      width:42px; height:42px; border-radius:12px;
      background: linear-gradient(135deg, var(--blue), rgba(37,99,235,.35));
      box-shadow: 0 10px 22px rgba(37,99,235,.18);
    }
    .brand h1{ margin:0; font-size:22px; letter-spacing:.2px; }
    .brand .tag{ margin-top:2px; color: var(--muted); font-size:13px; }

    .btn{
      border:1px solid var(--line);
      background: var(--panel);
      color: var(--text);
      border-radius: 12px;
      padding: 10px 12px;
      font-weight: 900;
      cursor:pointer;
      transition: transform .05s ease, background .15s ease, border .15s ease;
      user-select:none;
    }
    .btn:hover{ border-color: rgba(37,99,235,.55); }
    .btn:active{ transform: translateY(1px); }
    .btn.primary{
      background: linear-gradient(135deg, var(--blue), var(--blue2));
      border-color: rgba(37,99,235,.65);
      color:#fff;
    }

    .splashBody{
      margin-top:14px;
      border-top:1px solid var(--line);
      padding-top:14px;
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:16px;
    }
    .splashBody p{ margin:0; color: var(--muted); line-height:1.5; font-size:14px; }
    .pillRow{ display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end; align-items:flex-start; }
    .pill{
      background: rgba(37,99,235,.10);
      border:1px solid rgba(37,99,235,.28);
      color: var(--text);
      font-size:12px;
      padding: 6px 10px;
      border-radius: 999px;
      font-weight: 900;
      white-space: nowrap;
    }
    .pill.neutral{
      background: var(--chip);
      border-color: var(--line);
      color: var(--muted);
      font-weight: 900;
    }
    @media (max-width: 860px){
      .splashBody{ grid-template-columns: 1fr; }
      .pillRow{ justify-content:flex-start; }
    }

    /* Header */
    header{
      position: sticky;
      top:0;
      z-index: 50;
      backdrop-filter: blur(10px);
      background: color-mix(in srgb, var(--bg) 75%, transparent);
      border-bottom: 1px solid var(--line);
    }
    .wrap{ width:min(1180px, 94vw); margin: 0 auto; }
    .topbar{
      display:flex; align-items:center; justify-content:space-between;
      padding: 10px 0;
      gap: 12px;
      flex-wrap:wrap;
    }
    .leftTop{ display:flex; align-items:center; gap:10px; flex-wrap:wrap; }
    .miniLogo{
      width:28px; height:28px; border-radius:10px;
      background: linear-gradient(135deg, var(--blue), rgba(37,99,235,.25));
      box-shadow: 0 8px 18px rgba(37,99,235,.14);
    }
    .titleBlock{ display:flex; flex-direction:column; line-height:1.1; }
    .titleBlock b{ font-size: 14px; letter-spacing:.2px;}
    .titleBlock span{ font-size: 12px; color: var(--muted); margin-top:3px;}

    nav{ display:flex; gap: 8px; flex-wrap:wrap; align-items:center; }
    .tab{
      border:1px solid var(--line);
      background: var(--panel);
      color: var(--text);
      border-radius: 999px;
      padding: 8px 12px;
      font-weight: 1000;
      cursor:pointer;
      font-size: 13px;
    }
    .tab.active{
      background: rgba(37,99,235,.10);
      border-color: rgba(37,99,235,.40);
    }
    .tab.casos{
      padding: 10px 16px;
      font-size: 14px;
    }

    .rightTop{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; }
    .toggle{
      border:1px solid var(--line);
      background: var(--panel);
      border-radius: 999px;
      padding: 7px 10px;
      cursor:pointer;
      font-weight: 1000;
      color: var(--text);
      font-size: 13px;
    }

    main{ padding: 16px 0 28px; }

    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
    }
    @media (max-width: 980px){
      .grid2{ grid-template-columns: 1fr; }
    }

    .card{
      border:1px solid var(--line);
      background: var(--panel);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 14px;
    }
    .card h2{ margin:0; font-size: 16px; letter-spacing:.2px; }
    .sub{ margin:6px 0 0; color: var(--muted); font-size: 13px; line-height:1.4; }
    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .hr{ height:1px; background: var(--line); margin:12px 0; }

    label{
      display:block;
      font-weight: 1000;
      font-size: 12px;
      color: var(--muted);
      margin-bottom:6px;
      letter-spacing:.2px;
      text-transform: uppercase;
    }
    input, select, textarea{
      width:100%;
      box-sizing:border-box;
      border-radius: 12px;
      border:1px solid var(--line);
      background: var(--panel2);
      color: var(--text);
      padding: 10px 10px;
      outline: none;
      font-weight: 900;
      font-size: 14px;
    }
    textarea{ min-height: 90px; resize: vertical; font-family: var(--sans); }
    .small{ font-size: 12px; color: var(--muted); margin-top:6px; line-height:1.4; }
    .chip{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--line);
      background: var(--chip);
      color: var(--muted);
      font-weight: 1000;
      font-size: 12px;
    }
    .chip b{ color: var(--text); }
    .badge{
      display:inline-block;
      padding: 6px 10px;
      border-radius: 999px;
      font-weight: 1000;
      font-size: 12px;
      border:1px solid var(--line);
      background: var(--chip);
      color: var(--text);
    }
    .badge.good{ border-color: rgba(22,163,74,.35); background: rgba(22,163,74,.10); }
    .badge.warn{ border-color: rgba(245,158,11,.40); background: rgba(245,158,11,.10); }
    .badge.bad{ border-color: rgba(239,68,68,.40); background: rgba(239,68,68,.10); }

    details{
      border:1px solid var(--line);
      background: var(--panel2);
      border-radius: 14px;
      padding: 10px 12px;
    }
    summary{ cursor:pointer; font-weight: 1000; list-style:none; }
    summary::-webkit-details-marker{ display:none; }
    .klist{
      margin:10px 0 0;
      padding:0 0 0 18px;
      color: var(--muted);
      line-height:1.5;
      font-size: 13px;
    }
    .klist li{ margin: 6px 0; }
    .klist b{ color: var(--text); }

    a{ color: var(--text); text-decoration: none; border-bottom: 1px dashed rgba(37,99,235,.45); }
    a:hover{ border-bottom-color: rgba(37,99,235,.85); }

    .footer{
      margin-top: 14px;
      border-top: 1px solid var(--line);
      padding-top: 12px;
      color: var(--muted);
      font-size: 12px;
      line-height:1.45;
    }

    .mono{ font-family: var(--mono); }
    .hide{ display:none !important; }

    .checks{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    @media (max-width: 780px){
      .checks{ grid-template-columns: 1fr; }
    }
    .checkGroup{
      border:1px solid var(--line);
      background: var(--panel2);
      border-radius: 14px;
      padding: 10px 12px;
    }
    .checkGroup h3{ margin:0 0 8px; font-size: 13px; letter-spacing:.2px; }
    .opt{
      display:flex;
      gap:10px;
      align-items:flex-start;
      padding: 6px 0;
      border-top: 1px dashed color-mix(in srgb, var(--line) 70%, transparent);
    }
    .opt:first-of-type{ border-top: none; }
    .opt input{ width:auto; margin-top: 3px; }
    .opt div{ flex:1; }
    .opt b{ display:block; font-size: 13px; }
    .opt span{ display:block; color: var(--muted); font-size: 12px; line-height:1.35; margin-top:2px; }

    .outBox{
      border:1px solid var(--line);
      background: color-mix(in srgb, var(--panel2) 80%, transparent);
      border-radius: 14px;
      padding: 10px 12px;
    }
    .outBox h3{ margin:0 0 8px; font-size: 13px; }
    .outBox .txt{
      color: var(--muted);
      font-size: 13px;
      line-height:1.5;
      white-space:pre-wrap;
    }

    table{ width:100%; border-collapse: collapse; overflow:hidden; border-radius: 14px; }
    th,td{
      border-bottom: 1px solid var(--line);
      padding: 8px 10px;
      text-align: left;
      font-size: 13px;
    }
    th{ color: var(--muted); text-transform: uppercase; font-size: 12px; letter-spacing:.2px; }
    tr:last-child td{ border-bottom: none; }
    .tableWrap{
      border:1px solid var(--line);
      background: var(--panel2);
      border-radius: 14px;
      overflow:hidden;
    }
    .note{
      border-left: 4px solid rgba(37,99,235,.55);
      padding: 10px 12px;
      border-radius: 12px;
      background: rgba(37,99,235,.07);
      color: var(--muted);
      font-size: 13px;
      line-height:1.45;
    }
    .note b{ color: var(--text); }
  </style>
</head>

<body>

  <!-- SPLASH -->
  <div id="splash">
    <div class="splashCard">
      <div class="splashTop">
        <div class="brand">
          <div class="logo"></div>
          <div>
            <h1>SyncVent</h1>
            <div class="tag">Ventilação Mecânica — app educacional (não-prescritor)</div>
          </div>
        </div>
        <div class="splashBtns">
          <button class="btn primary" onclick="enterApp()">Entrar</button>
        </div>
      </div>

      <div class="splashBody">
        <p>
          Ferramenta educacional para organizar raciocínio em ventilação mecânica por cenários clínicos e por leitura de curvas.
          Não substitui protocolos, diretrizes institucionais, treinamento formal ou julgamento clínico.
        </p>
        <div class="pillRow">
          <span class="pill">SARA / Sepse / Choque</span>
          <span class="pill">DPOC / Obesidade</span>
          <span class="pill">Neuro / Trauma</span>
          <span class="pill">Assincronias</span>
          <span class="pill">Mecânica</span>
          <span class="pill neutral">Evidências</span>
        </div>
      </div>
    </div>
  </div>

  <!-- HEADER -->
  <header>
    <div class="wrap">
      <div class="topbar">
        <div class="leftTop">
          <div class="miniLogo"></div>
          <div class="titleBlock">
            <b>SyncVent</b>
            <span>Organizador educacional — cenários + motor por curvas</span>
          </div>
        </div>

        <nav>
          <button class="tab casos active" id="tabCasos" onclick="showTab('casos')">Casos</button>
          <button class="tab" id="tabAssin" onclick="showTab('assin')">Assincronias</button>
          <button class="tab" id="tabMec" onclick="showTab('mec')">Mecânica</button>
          <button class="tab" id="tabRefs" onclick="showTab('refs')">Evidências</button>
          <button class="tab" id="tabSobre" onclick="showTab('sobre')">Sobre</button>
        </nav>

        <div class="rightTop">
          <button class="toggle" onclick="openAllDetails()">Expandir</button>
          <button class="toggle" onclick="closeAllDetails()">Recolher</button>
        </div>
      </div>
    </div>
  </header>

  <main class="wrap">

    <!-- ===================== CASOS ===================== -->
    <section id="secCasos">
      <div class="card">
        <h2>Selecione o cenário clínico</h2>
        <p class="sub">
          O app abre blocos com: (1) definidores/estratificação, (2) parâmetros monitorados, (3) pontos de atenção por curvas/métricas,
          (4) links de diretrizes/consensos.
        </p>

        <div class="hr"></div>

        <div class="row">
          <div style="flex:1; min-width:240px;">
            <label>Cenário</label>
            <select id="caseSel" onchange="renderCase()">
              <option value="">Selecione…</option>
              <option value="sara">SARA (ARDS)</option>
              <option value="sepse">Sepse / Choque séptico</option>
              <option value="dpoc">DPOC (obstrutivo)</option>
              <option value="restritiva">Doença restritiva</option>
              <option value="cardiaca">Cardíaca (edema cardiogênico)</option>
              <option value="obeso">Obeso / OHS</option>
              <option value="neuro">Neuromuscular</option>
              <option value="neurocrit">Neurocrítico (TCE, tumor, etc.)</option>
              <option value="trauma">Trauma</option>
            </select>
          </div>
        </div>

        <div class="hr"></div>
        <div id="caseArea"></div>

        <div class="footer">
          <b>Nota de escopo:</b> app educacional. Não emite prescrição/ajuste; não substitui protocolos locais.
        </div>
      </div>
    </section>

    <!-- ===================== ASSINCRONIAS ===================== -->
    <section id="secAssin" class="hide">
      <div class="card">
        <h2>Assincronias — motor por achados observáveis</h2>
        <p class="sub">
          Selecione o que você vê no traçado (curva e fase do ciclo). O motor retorna hipóteses fisiológicas e limites.
        </p>

        <div class="hr"></div>

        <div class="row">
          <div style="flex:1; min-width:240px;">
            <label>Contexto (opcional)</label>
            <select id="assinContext">
              <option value="">Sem contexto</option>
              <option value="control">Controlado / mandatória</option>
              <option value="assist">Assistido (A/C, PSV, etc.)</option>
              <option value="wean">Desmame</option>
              <option value="obstruct">Obstrutivo (DPOC/asma)</option>
              <option value="lowC">Baixa complacência (SARA/restritiva)</option>
            </select>
          </div>
          <div style="flex:1; min-width:240px;">
            <label>Ação</label>
            <div class="row">
              <button class="btn primary" onclick="runAssinMotor()">Rodar motor</button>
              <button class="btn" onclick="resetChecks('assin')">Limpar</button>
            </div>
          </div>
        </div>

        <div class="hr"></div>

        <div class="checks">
          <div class="checkGroup">
            <h3>Pressão × tempo — disparo / início</h3>

            <div class="opt">
              <input type="checkbox" class="assin" value="pt_trigger_delay" />
              <div>
                <b>Antes do ciclo iniciar, aparece “esforço” e o ventilador demora a responder</b>
                <span>Achado compatível com atraso de disparo/dificuldade de trigger.</span>
              </div>
            </div>

            <div class="opt">
              <input type="checkbox" class="assin" value="pt_negative_deflection" />
              <div>
                <b>Queda negativa marcada de pressão no início (o paciente “puxa” para disparar)</b>
                <span>Achado compatível com carga para disparar (limiar/auto-PEEP/drive alto).</span>
              </div>
            </div>

            <div class="opt">
              <input type="checkbox" class="assin" value="pt_double_trigger" />
              <div>
                <b>Dois ciclos quase colados, com pouco ou nenhum tempo expiratório</b>
                <span>Confirmar em fluxo e volume (empilhamento).</span>
              </div>
            </div>
          </div>

          <div class="checkGroup">
            <h3>Fluxo × tempo — inspiração / término</h3>

            <div class="opt">
              <input type="checkbox" class="assin" value="ft_flow_starvation" />
              <div>
                <b>Durante a inspiração, a curva sugere demanda maior que a entrega (concavidade/“scoop”)</b>
                <span>Achado compatível com demanda &gt; entrega (modo-dependente).</span>
              </div>
            </div>

            <div class="opt">
              <input type="checkbox" class="assin" value="ft_early_cycle" />
              <div>
                <b>A inspiração termina enquanto ainda há esforço inspiratório do paciente</b>
                <span>Esforço continua após ciclar; em PSV, avaliar critério de ciclagem.</span>
              </div>
            </div>

            <div class="opt">
              <input type="checkbox" class="assin" value="ft_late_cycle" />
              <div>
                <b>A inspiração se mantém quando o paciente já parece querer expirar (desconforto no fim)</b>
                <span>Em PSV, pode refletir término tardio; confirmar padrão repetitivo.</span>
              </div>
            </div>
          </div>

          <div class="checkGroup">
            <h3>Fluxo × tempo — expiração</h3>

            <div class="opt">
              <input type="checkbox" class="assin" value="ft_exp_incomplete" />
              <div>
                <b>O fluxo expiratório não retorna a zero antes do próximo ciclo</b>
                <span>Achado compatível com expiração incompleta/air-trapping/auto-PEEP.</span>
              </div>
            </div>

            <div class="opt">
              <input type="checkbox" class="assin" value="ft_ineffective_effort" />
              <div>
                <b>Deflexões sugerem esforço em expiração, mas não ocorre disparo (ciclo não inicia)</b>
                <span>Achado compatível com esforço sem disparo (frequente com auto-PEEP + fraqueza).</span>
              </div>
            </div>

            <div class="opt">
              <input type="checkbox" class="assin" value="ft_auto_trigger" />
              <div>
                <b>O ventilador dispara ciclos sem padrão claro de esforço do paciente</b>
                <span>Considerar sensibilidade, vazamento, condensado e artefatos.</span>
              </div>
            </div>
          </div>

          <div class="checkGroup">
            <h3>Volume × tempo</h3>

            <div class="opt">
              <input type="checkbox" class="assin" value="vt_breath_stacking" />
              <div>
                <b>O volume não retorna ao baseline antes de novo ciclo (empilhamento)</b>
                <span>Confirmar junto de ciclos colados e/ou expiração incompleta.</span>
              </div>
            </div>

            <div class="opt">
              <input type="checkbox" class="assin" value="vt_leak_suspicion" />
              <div>
                <b>Discrepância persistente: volume expirado muito menor que o inspirado</b>
                <span>Achado compatível com vazamento/medição inconsistente (confirmar alarmes/inspeção).</span>
              </div>
            </div>
          </div>
        </div>

        <div class="hr"></div>

        <div class="outBox">
          <h3>Saída do motor (Assincronias)</h3>
          <div class="txt" id="assinOut">Selecione achados e clique em “Rodar motor”.</div>
        </div>
      </div>
    </section>

    <!-- ===================== MECÂNICA ===================== -->
    <section id="secMec" class="hide">
      <div class="card">
        <h2>Mecânica — hipóteses por achados nas curvas</h2>
        <p class="sub">Selecione achados de pressão/fluxo/volume. Saída: hipóteses e limites (educacional).</p>

        <div class="hr"></div>

        <div class="row">
          <div style="flex:1; min-width:240px;">
            <label>Contexto (opcional)</label>
            <select id="mecContext">
              <option value="">Sem contexto</option>
              <option value="lowC">Baixa complacência (SARA/restritiva)</option>
              <option value="highR">Alta resistência (DPOC/asma)</option>
              <option value="wean">Desmame / esforço</option>
              <option value="obeso">Obesidade / parede torácica</option>
            </select>
          </div>
          <div style="flex:1; min-width:240px;">
            <label>Ação</label>
            <div class="row">
              <button class="btn primary" onclick="runMecMotor()">Rodar motor</button>
              <button class="btn" onclick="resetChecks('mec')">Limpar</button>
            </div>
          </div>
        </div>

        <div class="hr"></div>

        <div class="checks">
          <div class="checkGroup">
            <h3>Pressão × tempo</h3>
            <div class="opt">
              <input type="checkbox" class="mec" value="pt_high_plateau" />
              <div>
                <b>Pressão sustentada alta no final da inspiração / platô elevado (se medido)</b>
                <span>Compatível com baixa complacência do sistema (pulmão/parede).</span>
              </div>
            </div>
            <div class="opt">
              <input type="checkbox" class="mec" value="pt_high_peak_normal_plateau" />
              <div>
                <b>Pico desproporcional no início (maior que o “final”/platô, quando disponível)</b>
                <span>Compatível com componente resistivo (via aérea/tubo/circuito).</span>
              </div>
            </div>
            <div class="opt">
              <input type="checkbox" class="mec" value="pt_sawtooth" />
              <div>
                <b>Serrilhado/oscilações (“dente de serra”) em pressão</b>
                <span>Pode refletir secreção, condensado, turbulência ou artefato.</span>
              </div>
            </div>
          </div>

          <div class="checkGroup">
            <h3>Fluxo × tempo</h3>
            <div class="opt">
              <input type="checkbox" class="mec" value="ft_exp_not_zero" />
              <div>
                <b>Fluxo expiratório não zera antes do próximo ciclo</b>
                <span>Compatível com expiração incompleta/auto-PEEP/obstrução/FR alta.</span>
              </div>
            </div>
            <div class="opt">
              <input type="checkbox" class="mec" value="ft_insp_decel_steep" />
              <div>
                <b>O fluxo inspiratório “cai rápido” durante a inspiração (modo-dependente)</b>
                <span>Pode sugerir baixa complacência dependendo do modo.</span>
              </div>
            </div>
            <div class="opt">
              <input type="checkbox" class="mec" value="ft_insp_decel_slow" />
              <div>
                <b>O fluxo inspiratório “cai lentamente” (modo-dependente)</b>
                <span>Pode sugerir resistência aumentada/constante de tempo alta.</span>
              </div>
            </div>
          </div>

          <div class="checkGroup">
            <h3>Volume × tempo</h3>
            <div class="opt">
              <input type="checkbox" class="mec" value="vt_slow_fill" />
              <div>
                <b>Subida do volume lenta/prolongada (enchimento lento)</b>
                <span>Pode refletir resistência/limitação de fluxo ou configuração do modo.</span>
              </div>
            </div>
            <div class="opt">
              <input type="checkbox" class="mec" value="vt_incomplete_empty" />
              <div>
                <b>Volume não retorna ao baseline antes do próximo ciclo</b>
                <span>Compatível com air-trapping/auto-PEEP/expiração curta.</span>
              </div>
            </div>
            <div class="opt">
              <input type="checkbox" class="mec" value="vt_leak" />
              <div>
                <b>Discrepância persistente entre volume inspirado e expirado</b>
                <span>Compatível com vazamento/medição inconsistente.</span>
              </div>
            </div>
          </div>

          <div class="checkGroup">
            <h3>Integração</h3>
            <div class="opt">
              <input type="checkbox" class="mec" value="met_asynchrony_suspect" />
              <div>
                <b>O padrão sugere que pode haver assincronia coexistente</b>
                <span>Use o módulo “Assincronias”.</span>
              </div>
            </div>
          </div>
        </div>

        <div class="hr"></div>

        <div class="outBox">
          <h3>Saída do motor (Mecânica)</h3>
          <div class="txt" id="mecOut">Selecione achados e clique em “Rodar motor”.</div>
        </div>
      </div>
    </section>

    <!-- ===================== EVIDÊNCIAS ===================== -->
    <section id="secRefs" class="hide">
      <div class="card">
        <h2>Evidências e consensos (por cenário)</h2>
        <p class="sub">Links diretos para diretrizes/consensos e revisões relevantes. (Sem prescrição; uso educacional.)</p>

        <div class="hr"></div>

        <div class="grid2">
          <div class="card" style="box-shadow:none; background: var(--panel2);">
            <h2>Brasil — AMIB/SBPT (Ventilação)</h2>
            <ul class="klist">
              <li><b>Orientações Práticas em Ventilação Mecânica 2024 (AMIB/SBPT)</b> — <a href="https://d1xe7tfg0uwul9.cloudfront.net/amib-portal/wp-content/uploads/2024/09/12100249/Orientacoes-Praticas-de-Ventilacao-Mecanica-Interativo-SET-11-1.pdf" target="_blank">PDF</a></li>
              <li><b>Notícia AMIB</b> — <a href="https://amib.org.br/amib-e-sbpt-lancam-edicao-atualizada-das-orientacoes-praticas-em-ventilacao-mecanica/" target="_blank">página</a></li>
            </ul>
          </div>

          <div class="card" style="box-shadow:none; background: var(--panel2);">
            <h2>SARA (ARDS) — Global Definition / Europa</h2>
            <ul class="klist">
              <li><b>Global Definition of ARDS</b> — PMC: <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC10870872/" target="_blank">texto</a></li>
              <li><b>Global Definition (PubMed)</b> — <a href="https://pubmed.ncbi.nlm.nih.gov/37487152/" target="_blank">37487152</a></li>
              <li><b>ESICM ARDS Guidelines 2023</b> — <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC10354163/" target="_blank">PMC</a></li>
              <li><b>Press release ATS (resumo)</b> — <a href="https://site.thoracic.org/press-releases/experts-propose-new-global-definition-of-acute-respiratory-distress-syndrome" target="_blank">ATS</a></li>
            </ul>
            <div class="note" style="margin-top:10px;">
              <b>Critérios-chave (Global Definition):</b> inclui HFNO (≥30 L/min) e permite SpO₂/FiO₂ ≤ 315 se SpO₂ ≤ 97%. :contentReference[oaicite:2]{index=2}
            </div>
          </div>

          <div class="card" style="box-shadow:none; background: var(--panel2);">
            <h2>Cardíaca — Edema pulmonar cardiogênico</h2>
            <ul class="klist">
              <li><b>Cochrane 2019 — CPAP/BiPAP em edema cardiogênico</b> — <a href="https://www.cochranelibrary.com/cdsr/doi/10.1002/14651858.CD005351.pub4/full" target="_blank">Cochrane</a></li>
              <li><b>ERS/ATS NIV (2017)</b> — PDF: <a href="https://www.thoracic.org/statements/resources/cc/niv-guidelines.pdf" target="_blank">guideline</a></li>
              <li><b>Clinical review ERS (2024)</b> — <a href="https://publications.ersnet.org/content/erj/64/5/2400396" target="_blank">ERJ</a></li>
              <li><b>Guia clínico (2025, PMC) — suporte não invasivo em edema cardiogênico</b> — <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC12625427/" target="_blank">PMC</a></li>
            </ul>
          </div>

          <div class="card" style="box-shadow:none; background: var(--panel2);">
            <h2>Obesidade / OHS</h2>
            <ul class="klist">
              <li><b>Ventilation in the obese (ERS Review 2025)</b> — <a href="https://publications.ersnet.org/content/errev/34/176/240190" target="_blank">ERR</a></li>
              <li><b>Transpulmonary pressure-guided strategies (Respiratory Care 2021)</b> — <a href="https://www.liebertpub.com/doi/pdf/10.4187/respcare.08686" target="_blank">PDF</a></li>
              <li><b>PEEP optimization in obesity (BJA 2025)</b> — <a href="https://www.bjanaesthesia.org/article/S0007-0912%2825%2900639-7/fulltext" target="_blank">BJA</a></li>
            </ul>
          </div>

          <div class="card" style="box-shadow:none; background: var(--panel2);">
            <h2>Neuromuscular</h2>
            <ul class="klist">
              <li><b>CHEST Guideline 2023 — manejo respiratório em NMD</b> — <a href="https://journal.chestnet.org/article/S0012-3692%2823%2900353-7/fulltext" target="_blank">CHEST</a></li>
              <li><b>ERS/ATS NIV (2017)</b> — <a href="https://www.thoracic.org/statements/resources/cc/niv-guidelines.pdf" target="_blank">PDF</a></li>
            </ul>
          </div>

          <div class="card" style="box-shadow:none; background: var(--panel2);">
            <h2>HFNC / Suporte não invasivo (geral)</h2>
            <ul class="klist">
              <li><b>ERS guideline HFNC em insuficiência respiratória aguda (2022)</b> — <a href="https://publications.ersnet.org/content/erj/59/4/2101574" target="_blank">ERJ</a></li>
              <li><b>ERS/ATS NIV (2017)</b> — <a href="https://www.thoracic.org/statements/resources/cc/niv-guidelines.pdf" target="_blank">PDF</a></li>
            </ul>
          </div>

          <div class="card" style="box-shadow:none; background: var(--panel2);">
            <h2>Neurocrítico / TCE</h2>
            <ul class="klist">
              <li><b>ACS TQP Best Practices Guidelines — TBI (2025)</b> — <a href="https://www.facs.org/media/vgfgjpfk/best-practices-guidelines-traumatic-brain-injury.pdf" target="_blank">PDF</a></li>
              <li><b>Resumo de diretriz (recomenda contra hiperventilação profilática prolongada)</b> — <a href="https://www.nature.com/articles/s41598-025-04793-9" target="_blank">Sci Rep 2025</a></li>
            </ul>
          </div>
        </div>

        <div class="footer">
          Critério editorial: priorizar diretriz/consenso e revisões; estudos originais entram como suporte didático.
        </div>
      </div>
    </section>

    <!-- ===================== SOBRE ===================== -->
    <section id="secSobre" class="hide">
      <div class="card">
        <h2>Sobre</h2>
        <p class="sub">SyncVent é um app educacional para organizar raciocínio por cenários e por leitura de curvas.</p>

        <div class="hr"></div>

        <details open>
          <summary>Uso e limites</summary>
          <ul class="klist">
            <li><b>Não-prescritor:</b> não fornece ordens de ajuste.</li>
            <li><b>Apoio à decisão:</b> estrutura pontos de atenção e hipóteses.</li>
            <li><b>Responsabilidade:</b> decisão clínica é do profissional e da equipe.</li>
          </ul>
        </details>
      </div>
    </section>

  </main>

  <script>
    function enterApp(){
      const el = document.getElementById("splash");
      el.classList.add("hide");
      setTimeout(()=>{ el.style.display="none"; }, 420);
    }

    function showTab(which){
      const secCasos = document.getElementById("secCasos");
      const secAssin = document.getElementById("secAssin");
      const secMec = document.getElementById("secMec");
      const secRefs = document.getElementById("secRefs");
      const secSobre = document.getElementById("secSobre");

      secCasos.classList.toggle("hide", which!=="casos");
      secAssin.classList.toggle("hide", which!=="assin");
      secMec.classList.toggle("hide", which!=="mec");
      secRefs.classList.toggle("hide", which!=="refs");
      secSobre.classList.toggle("hide", which!=="sobre");

      document.getElementById("tabCasos").classList.toggle("active", which==="casos");
      document.getElementById("tabAssin").classList.toggle("active", which==="assin");
      document.getElementById("tabMec").classList.toggle("active", which==="mec");
      document.getElementById("tabRefs").classList.toggle("active", which==="refs");
      document.getElementById("tabSobre").classList.toggle("active", which==="sobre");

      window.scrollTo({top:0, behavior:"smooth"});
    }

    function openAllDetails(){ document.querySelectorAll("details").forEach(d=> d.open = true); }
    function closeAllDetails(){ document.querySelectorAll("details").forEach(d=> d.open = false); }

    function num(v){
      if(v===null || v===undefined) return NaN;
      const s = String(v).replace(",", ".").trim();
      const n = Number(s);
      return Number.isFinite(n) ? n : NaN;
    }

    const CASES = {
      sara: {
        title: "SARA (ARDS) — Global Definition (educacional) + estratificação por hipoxemia",
        lead: "Inclui HFNO (≥30 L/min) e alternativa SpO₂/FiO₂ ≤ 315 quando SpO₂ ≤ 97% (Global Definition).",
        render: () => `
          <div class="grid2">
            <div class="card" style="box-shadow:none; background: var(--panel2);">
              <h2>Triagem de hipoxemia compatível com SARA (Global Definition)</h2>
              <p class="sub">
                Este bloco calcula: PaO₂/FiO₂ e/ou SpO₂/FiO₂. Para SpO₂/FiO₂, o critério é válido quando <b>SpO₂ ≤ 97%</b>.
                HFNO é considerado no critério com <b>fluxo ≥ 30 L/min</b>.
              </p>

              <div class="hr"></div>

              <div class="row">
                <div style="flex:1; min-width:220px;">
                  <label>Tipo de suporte (para critério Global)</label>
                  <select id="supportType" onchange="updateArdsGlobal()">
                    <option value="">Selecione…</option>
                    <option value="imv">VM invasiva</option>
                    <option value="niv">NIV/CPAP</option>
                    <option value="hfno">HFNO</option>
                  </select>
                  <div class="small">Global Definition inclui HFNO ≥30 L/min. :contentReference[oaicite:3]{index=3}</div>
                </div>
                <div style="flex:1; min-width:220px;">
                  <label>PEEP/CPAP (cmH₂O) — se aplicável</label>
                  <input id="peep" placeholder="ex.: 10" oninput="updateArdsGlobal()"/>
                  <div class="small">Em VM invasiva/NIV, PEEP/CPAP é usada na prática para padronização (ver diretrizes locais).</div>
                </div>
              </div>

              <div style="height:10px;"></div>

              <div class="row">
                <div style="flex:1; min-width:220px;">
                  <label>Fluxo HFNO (L/min) — apenas se HFNO</label>
                  <input id="hfFlow" placeholder="ex.: 40" oninput="updateArdsGlobal()"/>
                  <div class="small">Critério: HFNO ≥ 30 L/min. :contentReference[oaicite:4]{index=4}</div>
                </div>
                <div style="flex:1; min-width:220px;">
                  <label>FiO₂ (fração)</label>
                  <input id="fio2" placeholder="ex.: 0,60" oninput="updateArdsGlobal()"/>
                </div>
              </div>

              <div style="height:10px;"></div>

              <div class="row">
                <div style="flex:1; min-width:220px;">
                  <label>PaO₂ (mmHg) — opcional</label>
                  <input id="pao2" placeholder="ex.: 80" oninput="updateArdsGlobal()"/>
                  <div class="small">Se disponível, PaO₂/FiO₂ é a referência.</div>
                </div>
                <div style="flex:1; min-width:220px;">
                  <label>SpO₂ (%) — opcional</label>
                  <input id="spo2" placeholder="ex.: 92" oninput="updateArdsGlobal()"/>
                  <div class="small">Para usar SpO₂/FiO₂ no critério, aplicar quando <b>SpO₂ ≤ 97%</b>. :contentReference[oaicite:5]{index=5}</div>
                </div>
              </div>

              <div class="hr"></div>

              <label>Atalhos (após preenchimento)</label>
              <div class="row">
                <span class="chip">P/F <b class="mono" id="pfQuick">—</b></span>
                <span class="chip">S/F <b class="mono" id="sfQuick">—</b></span>
                <span class="chip">Compatível Global? <b class="mono" id="globalQuick">—</b></span>
              </div>

              <div style="height:10px;"></div>

              <div class="outBox">
                <h3>Resultado</h3>
                <div class="txt" id="ardsOut">Preencha suporte, FiO₂ e PaO₂ e/ou SpO₂.</div>
              </div>

              <div class="hr"></div>

              <details open>
                <summary>Pontos de atenção (educacional)</summary>
                <ul class="klist">
                  <li><b>Critério de hipoxemia (Global):</b> PaO₂/FiO₂ ≤ 300, ou SpO₂/FiO₂ ≤ 315 se SpO₂ ≤ 97%. :contentReference[oaicite:6]{index=6}</li>
                  <li><b>HFNO no critério:</b> fluxo ≥ 30 L/min. :contentReference[oaicite:7]{index=7}</li>
                  <li><b>Integração:</b> diagnóstico completo inclui início temporal e critério de imagem (bilateral opacities; US pulmonar pode ser usado em alguns contextos).</li>
                </ul>
              </details>

              <details>
                <summary>Links (SARA)</summary>
                <ul class="klist">
                  <li><b>Global Definition (PMC)</b> — <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC10870872/" target="_blank">texto</a></li>
                  <li><b>ESICM ARDS 2023</b> — <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC10354163/" target="_blank">PMC</a></li>
                  <li><b>AMIB/SBPT 2024</b> — <a href="https://d1xe7tfg0uwul9.cloudfront.net/amib-portal/wp-content/uploads/2024/09/12100249/Orientacoes-Praticas-de-Ventilacao-Mecanica-Interativo-SET-11-1.pdf" target="_blank">PDF</a></li>
                </ul>
              </details>
            </div>

            <div class="card" style="box-shadow:none; background: var(--panel2);">
              <h2>Tabela PEEP/FiO₂ (educacional)</h2>
              <div class="tableWrap">
                <table>
                  <thead><tr><th>FiO₂</th><th>PEEP (cmH₂O)</th></tr></thead>
                  <tbody>
                    <tr><td>0,30</td><td>5</td></tr>
                    <tr><td>0,40</td><td>5–8</td></tr>
                    <tr><td>0,50</td><td>8–10</td></tr>
                    <tr><td>0,60</td><td>10</td></tr>
                    <tr><td>0,70</td><td>10–12</td></tr>
                    <tr><td>0,80</td><td>12–14</td></tr>
                    <tr><td>0,90</td><td>14</td></tr>
                    <tr><td>1,00</td><td>14–18</td></tr>
                  </tbody>
                </table>
              </div>
              <div class="note" style="margin-top:10px;">
                <b>Nota:</b> esta tabela é didática; use o protocolo institucional como referência.
              </div>
            </div>
          </div>
        `
      },

      sepse: {
        title: "Sepse / Choque séptico — ventilação (pontos de atenção)",
        lead: "Checklist por curvas e integração com SARA (use o bloco SARA quando houver hipoxemia).",
        render: () => `
          <div class="grid2">
            <div class="card" style="box-shadow:none; background: var(--panel2);">
              <h2>Pontos de atenção (educacional)</h2>
              <ul class="klist">
                <li><b>Demanda ventilatória alta</b> pode aumentar assincronias; use “Assincronias”.</li>
                <li><b>Se hipoxemia relevante</b>, avaliar compatibilidade com SARA (Global Definition) no bloco SARA. :contentReference[oaicite:8]{index=8}</li>
                <li><b>Integração hemodinâmica:</b> observar resposta clínica a mudanças ventilatórias.</li>
              </ul>
              <details>
                <summary>Links</summary>
                <ul class="klist">
                  <li><b>AMIB/SBPT 2024</b> — <a href="https://d1xe7tfg0uwul9.cloudfront.net/amib-portal/wp-content/uploads/2024/09/12100249/Orientacoes-Praticas-de-Ventilacao-Mecanica-Interativo-SET-11-1.pdf" target="_blank">PDF</a></li>
                </ul>
              </details>
            </div>
            <div class="card" style="box-shadow:none; background: var(--panel2);">
              <h2>Checklist por curvas</h2>
              <ul class="klist">
                <li><b>Fluxo:</b> expiração zera? há sinais de esforço sem disparo?</li>
                <li><b>Pressão:</b> picos/oscilações; desconforto e sincronia.</li>
                <li><b>Volume:</b> empilhamento/retorno ao baseline.</li>
              </ul>
            </div>
          </div>
        `
      },

      dpoc: {
        title: "DPOC (obstrutivo)",
        lead: "Foco em expiração incompleta/auto-PEEP e assincronias típicas.",
        render: () => `
          <div class="grid2">
            <div class="card" style="box-shadow:none; background: var(--panel2);">
              <h2>Pontos de atenção</h2>
              <ul class="klist">
                <li><b>Fluxo expiratório não zera</b> sugere expiração incompleta/auto-PEEP.</li>
                <li><b>Esforço sem disparo</b> pode ocorrer em auto-PEEP + fraqueza.</li>
              </ul>
              <details>
                <summary>Links</summary>
                <ul class="klist">
                  <li><b>AMIB/SBPT 2024</b> — <a href="https://d1xe7tfg0uwul9.cloudfront.net/amib-portal/wp-content/uploads/2024/09/12100249/Orientacoes-Praticas-de-Ventilacao-Mecanica-Interativo-SET-11-1.pdf" target="_blank">PDF</a></li>
                </ul>
              </details>
            </div>
            <div class="card" style="box-shadow:none; background: var(--panel2);">
              <h2>Use os motores</h2>
              <ul class="klist">
                <li><b>Assincronias:</b> selecione o que vê (ciclos colados, esforço sem disparo, expiração incompleta).</li>
                <li><b>Mecânica:</b> resistência vs auto-PEEP vs artefato.</li>
              </ul>
            </div>
          </div>
        `
      },

      restritiva: {
        title: "Doença restritiva",
        lead: "Sinais de baixa complacência e integração com hipoxemia.",
        render: () => `
          <div class="grid2">
            <div class="card" style="box-shadow:none; background: var(--panel2);">
              <h2>Pontos de atenção</h2>
              <ul class="klist">
                <li><b>Pressão sustentada alta</b> pode sugerir baixa complacência.</li>
                <li><b>Se hipoxemia</b>, usar bloco SARA (Global Definition). :contentReference[oaicite:9]{index=9}</li>
              </ul>
            </div>
            <div class="card" style="box-shadow:none; background: var(--panel2);">
              <h2>Links</h2>
              <ul class="klist">
                <li><b>ESICM ARDS 2023</b> — <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC10354163/" target="_blank">PMC</a></li>
                <li><b>AMIB/SBPT 2024</b> — <a href="https://d1xe7tfg0uwul9.cloudfront.net/amib-portal/wp-content/uploads/2024/09/12100249/Orientacoes-Praticas-de-Ventilacao-Mecanica-Interativo-SET-11-1.pdf" target="_blank">PDF</a></li>
              </ul>
            </div>
          </div>
        `
      },

      cardiaca: {
        title: "Cardíaca (edema cardiogênico)",
        lead: "Evidência forte para CPAP/BiPAP em edema cardiogênico; integração com hemodinâmica (educacional).",
        render: () => `
          <div class="grid2">
            <div class="card" style="box-shadow:none; background: var(--panel2);">
              <h2>Pontos de atenção</h2>
              <ul class="klist">
                <li><b>Oxigenação</b> e <b>trabalho respiratório</b> melhoram com pressão positiva em edema cardiogênico em diversos estudos e revisões.</li>
                <li><b>Integração hemodinâmica</b> é mandatória.</li>
              </ul>
            </div>
            <div class="card" style="box-shadow:none; background: var(--panel2);">
              <h2>Links</h2>
              <ul class="klist">
                <li><b>Cochrane 2019</b> — <a href="https://www.cochranelibrary.com/cdsr/doi/10.1002/14651858.CD005351.pub4/full" target="_blank">CD005351</a></li>
                <li><b>ERS/ATS NIV 2017</b> — <a href="https://www.thoracic.org/statements/resources/cc/niv-guidelines.pdf" target="_blank">PDF</a></li>
                <li><b>Clinical guide (PMC 2025)</b> — <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC12625427/" target="_blank">texto</a></li>
              </ul>
            </div>
          </div>
        `
      },

      obeso: {
        title: "Obeso / OHS",
        lead: "Interpretação de pressões no contexto de parede torácica e estratégias individualizadas (educacional).",
        render: () => `
          <div class="grid2">
            <div class="card" style="box-shadow:none; background: var(--panel2);">
              <h2>Pontos de atenção</h2>
              <ul class="klist">
                <li><b>Pressões mais altas</b> podem refletir contribuição de parede torácica.</li>
                <li><b>Risco de colapso/atelectasia</b> e dificuldade de desmame são temas recorrentes na literatura.</li>
              </ul>
            </div>
            <div class="card" style="box-shadow:none; background: var(--panel2);">
              <h2>Links</h2>
              <ul class="klist">
                <li><b>ERS Review 2025</b> — <a href="https://publications.ersnet.org/content/errev/34/176/240190" target="_blank">ERRev</a></li>
                <li><b>Respiratory Care 2021</b> — <a href="https://www.liebertpub.com/doi/pdf/10.4187/respcare.08686" target="_blank">PDF</a></li>
                <li><b>BJA 2025</b> — <a href="https://www.bjanaesthesia.org/article/S0007-0912%2825%2900639-7/fulltext" target="_blank">artigo</a></li>
              </ul>
            </div>
          </div>
        `
      },

      neuro: {
        title: "Neuromuscular",
        lead: "Foco em fraqueza, esforço sem disparo e suporte ventilatório (educacional).",
        render: () => `
          <div class="grid2">
            <div class="card" style="box-shadow:none; background: var(--panel2);">
              <h2>Pontos de atenção</h2>
              <ul class="klist">
                <li><b>Esforço sem disparo</b> é frequente com fraqueza + auto-PEEP.</li>
                <li><b>Integração com secreção</b> e trabalho respiratório é fundamental.</li>
              </ul>
            </div>
            <div class="card" style="box-shadow:none; background: var(--panel2);">
              <h2>Links</h2>
              <ul class="klist">
                <li><b>CHEST Guideline 2023</b> — <a href="https://journal.chestnet.org/article/S0012-3692%2823%2900353-7/fulltext" target="_blank">texto</a></li>
                <li><b>ERS/ATS NIV 2017</b> — <a href="https://www.thoracic.org/statements/resources/cc/niv-guidelines.pdf" target="_blank">PDF</a></li>
              </ul>
            </div>
          </div>
        `
      },

      neurocrit: {
        title: "Neurocrítico (TCE, tumor, etc.)",
        lead: "Evitar extremos de PaCO₂ e reduzir oscilações por assincronia (educacional; seguir protocolo local).",
        render: () => `
          <div class="grid2">
            <div class="card" style="box-shadow:none; background: var(--panel2);">
              <h2>Pontos de atenção</h2>
              <ul class="klist">
                <li><b>Evitar hiperventilação profilática prolongada</b> e oscilações grandes de CO₂ quando possível (contexto-dependente).</li>
                <li><b>Assincronias</b> podem aumentar variação de pressões/CO₂; use o motor.</li>
              </ul>
            </div>
            <div class="card" style="box-shadow:none; background: var(--panel2);">
              <h2>Links</h2>
              <ul class="klist">
                <li><b>ACS TQP TBI (2025)</b> — <a href="https://www.facs.org/media/vgfgjpfk/best-practices-guidelines-traumatic-brain-injury.pdf" target="_blank">PDF</a></li>
              </ul>
            </div>
          </div>
        `
      },

      trauma: {
        title: "Trauma",
        lead: "Fenótipos mistos e leitura sistemática por curvas (educacional).",
        render: () => `
          <div class="grid2">
            <div class="card" style="box-shadow:none; background: var(--panel2);">
              <h2>Pontos de atenção</h2>
              <ul class="klist">
                <li><b>Fenótipos mistos:</b> choque/contusão/obstrução/SARA podem coexistir.</li>
                <li><b>Curvas:</b> expiração incompleta, resistência, assincronia por dor/drive alto.</li>
              </ul>
            </div>
            <div class="card" style="box-shadow:none; background: var(--panel2);">
              <h2>Link (TBI/Trauma)</h2>
              <ul class="klist">
                <li><b>ACS TQP TBI (2025)</b> — <a href="https://www.facs.org/media/vgfgjpfk/best-practices-guidelines-traumatic-brain-injury.pdf" target="_blank">PDF</a></li>
              </ul>
            </div>
          </div>
        `
      }
    };

    function renderCase(){
      const v = document.getElementById("caseSel").value;
      const area = document.getElementById("caseArea");
      if(!v){ area.innerHTML = ""; return; }
      const c = CASES[v];
      area.innerHTML = `
        <div class="card" style="box-shadow:none; background: var(--panel2);">
          <div class="row" style="justify-content:space-between;">
            <div>
              <h2>${c.title}</h2>
              <p class="sub">${c.lead}</p>
            </div>
            <div class="row">
              <span class="badge good">educacional</span>
              <span class="badge warn">não-prescritor</span>
            </div>
          </div>
          <div class="hr"></div>
          ${c.render()}
        </div>
      `;
      if(v==="sara"){ setTimeout(updateArdsGlobal, 0); }
    }

    // ===== ARDS Global Definition screening (educational) =====
    function updateArdsGlobal(){
      const support = document.getElementById("supportType")?.value || "";
      const peep = num(document.getElementById("peep")?.value);
      const hfFlow = num(document.getElementById("hfFlow")?.value);
      const fio2 = num(document.getElementById("fio2")?.value);
      const pao2 = num(document.getElementById("pao2")?.value);
      const spo2 = num(document.getElementById("spo2")?.value);

      const out = document.getElementById("ardsOut");
      if(!out) return;

      let lines = [];
      let pf = NaN, sf = NaN;

      if(Number.isFinite(pao2) && Number.isFinite(fio2) && fio2>0){
        pf = pao2 / fio2;
        document.getElementById("pfQuick").textContent = pf.toFixed(0);
        lines.push(`PaO₂/FiO₂ = ${pf.toFixed(0)} mmHg`);
      }else{
        document.getElementById("pfQuick").textContent = "—";
      }

      if(Number.isFinite(spo2) && Number.isFinite(fio2) && fio2>0){
        sf = spo2 / fio2;
        document.getElementById("sfQuick").textContent = sf.toFixed(0);
        lines.push(`SpO₂/FiO₂ = ${sf.toFixed(0)} (usar quando SpO₂ ≤ 97%)`);
      }else{
        document.getElementById("sfQuick").textContent = "—";
      }

      if(support) lines.push(`Suporte: ${support.toUpperCase()}`);
      if(Number.isFinite(peep)) lines.push(`PEEP/CPAP: ${peep.toFixed(0)} cmH₂O`);
      if(support==="hfno" && Number.isFinite(hfFlow)) lines.push(`HFNO fluxo: ${hfFlow.toFixed(0)} L/min`);

      // Global hypoxemia criteria
      let hypoxemia = false;
      let hypoxemiaWhy = [];

      if(Number.isFinite(pf) && pf <= 300){
        hypoxemia = true;
        hypoxemiaWhy.push("PaO₂/FiO₂ ≤ 300");
      }
      if(Number.isFinite(sf) && Number.isFinite(spo2) && spo2 <= 97 && sf <= 315){
        hypoxemia = true;
        hypoxemiaWhy.push("SpO₂/FiO₂ ≤ 315 com SpO₂ ≤ 97%");
      }

      // HFNO inclusion (≥30 L/min) note
      let supportOk = true;
      if(support==="hfno"){
        if(Number.isFinite(hfFlow) && hfFlow >= 30){
          supportOk = true;
        }else{
          supportOk = false;
        }
      }

      let globalCompat = "—";
      if(!support){
        globalCompat = "Selecione o tipo de suporte";
      }else if(support==="hfno" && !Number.isFinite(hfFlow)){
        globalCompat = "Preencha fluxo HFNO";
      }else if(support==="hfno" && supportOk===false){
        globalCompat = "HFNO < 30 L/min (fora do critério Global)";
      }else if(!Number.isFinite(fio2)){
        globalCompat = "Preencha FiO₂";
      }else{
        globalCompat = (hypoxemia ? "SIM (hipoxemia compatível)" : "NÃO (sem hipoxemia pelo critério)");
      }

      document.getElementById("globalQuick").textContent = globalCompat.includes("SIM") ? "SIM" : (globalCompat.includes("NÃO") ? "NÃO" : "—");

      let tail = "";
      if(hypoxemia){
        tail += `\nCritério(s) atendido(s): ${hypoxemiaWhy.join(" + ")}.`;
      }
      if(support==="hfno"){
        tail += supportOk ? "\nHFNO: fluxo ≥ 30 L/min (ok no critério Global)." : "\nHFNO: fluxo < 30 L/min (não atende critério Global).";
      }

      if(lines.length===0){
        out.textContent = "Preencha suporte, FiO₂ e PaO₂ e/ou SpO₂.";
        return;
      }

      out.textContent =
        lines.join("\n") +
        "\n\nCompatibilidade Global (hipoxemia): " + globalCompat +
        tail +
        "\n\nObservação: diagnóstico completo de SARA requer também critérios clínicos/temporais e de imagem (educacional).";
    }

    // ===== Motors: Assincronias =====
    const ASSIN_RULES = [
      {
        when:["ft_ineffective_effort"],
        title:"Esforço observado sem disparo (compatível com esforço inefetivo)",
        conf:"Alta",
        phys:"Esforço ocorre sem gatilho. Em obstrutivo, auto-PEEP eleva o limiar; em fraqueza, o esforço não atinge o limiar.",
        hypos:["Auto-PEEP/air-trapping","Sensibilidade/atraso de trigger","Fraqueza/fadiga","Sedação/coordenação"],
        limits:"Integrar com modo, presença de expiração incompleta e esforço clínico."
      },
      {
        when:["pt_double_trigger"],
        title:"Dois ciclos quase colados (compatível com duplo disparo)",
        conf:"Alta",
        phys:"Demanda inspiratória excede tempo/volume do ciclo, favorecendo novo disparo antes de expiração completa.",
        hypos:["Tempo inspiratório curto","Drive elevado","Término precoce da inspiração"],
        limits:"Confirmar com volume (empilhamento) e fluxo expiratório."
      },
      {
        when:["ft_flow_starvation"],
        title:"Demanda aparente maior que a entrega na inspiração (fluxo insuficiente)",
        conf:"Média–Alta",
        phys:"Concavidade sugere demanda > entrega naquele momento.",
        hypos:["Drive alto","Entrega limitada (modo-dependente)","Término inadequado da inspiração"],
        limits:"Interpretação depende do modo."
      },
      {
        when:["ft_early_cycle"],
        title:"Inspiração termina com esforço ainda presente (término precoce)",
        conf:"Média",
        phys:"O ciclo termina antes do fim do esforço; esforço persiste após ciclar.",
        hypos:["Critério de ciclagem cedo (PSV)","Ti curto","Drive alto"],
        limits:"Confirmar em pressão/fluxo."
      },
      {
        when:["ft_late_cycle"],
        title:"Inspiração se mantém quando há desejo expiratório (término tardio)",
        conf:"Média",
        phys:"Ventilador mantém inspiração quando paciente já tenta expirar.",
        hypos:["Critério tardio (PSV)","Ti excessivo","Mudança do drive neural"],
        limits:"Confirmar padrão repetitivo."
      },
      {
        when:["ft_auto_trigger"],
        title:"Ciclos sem padrão claro de esforço (auto-disparo/artefato)",
        conf:"Média",
        phys:"Sensibilidade elevada ou artefatos (leak/condensado) podem gerar ciclos.",
        hypos:["Vazamento","Condensado","Sensibilidade alta"],
        limits:"Confirmar com alarmes/inspeção."
      },
      {
        when:["ft_exp_incomplete"],
        title:"Fluxo expiratório não zera (expiração incompleta/auto-PEEP)",
        conf:"Média–Alta",
        phys:"Sugere tempo expiratório insuficiente, obstrução ou constante de tempo alta.",
        hypos:["Obstrução","FR alta/Te curto","Aprisionamento"],
        limits:"Medidas formais aumentam confiabilidade."
      }
    ];

    function runAssinMotor(){
      const ctx = document.getElementById("assinContext").value;
      const picked = [...document.querySelectorAll("input.assin:checked")].map(x=>x.value);

      if(picked.length===0){
        document.getElementById("assinOut").textContent = "Selecione ao menos 1 achado e rode novamente.";
        return;
      }

      let hits = ASSIN_RULES.filter(r => r.when.some(w => picked.includes(w)));

      let lines = [];
      lines.push(`Contexto: ${ctx ? ctx : "não informado"}`);
      lines.push(`Achados selecionados: ${picked.join(", ")}`);
      lines.push("");

      hits.forEach((r, idx) => {
        lines.push(`(${idx+1}) ${r.title} — Confiança: ${r.conf}`);
        lines.push(`Fisiologia: ${r.phys}`);
        lines.push(`Hipóteses:\n${r.hypos.map(x=>"- "+x).join("\n")}`);
        lines.push(`Limites: ${r.limits}`);
        lines.push("");
      });

      document.getElementById("assinOut").textContent = lines.join("\n");
    }

    // ===== Motors: Mecânica =====
    const MEC_RULES = [
      {
        whenAny:["pt_high_plateau","ft_insp_decel_steep"],
        title:"Baixa complacência provável (pulmão e/ou parede torácica)",
        conf:"Média",
        phys:"Pressão sustentada alta e padrões compatíveis podem sugerir sistema mais rígido.",
        hypos:["SARA/edema/atelectasia","Restritiva","Obesidade/parede"],
        limits:"Interpretar com modo e contexto."
      },
      {
        whenAny:["pt_high_peak_normal_plateau","ft_insp_decel_slow","ft_exp_not_zero"],
        title:"Resistência aumentada / constante de tempo alta provável",
        conf:"Média–Alta",
        phys:"Pico desproporcional e expiração prolongada favorecem componente resistivo e risco de aprisionamento.",
        hypos:["DPOC/asma","Tubo/circuito (dobras, secreção, condensado)"],
        limits:"Integrar com ausculta e inspeção."
      },
      {
        whenAny:["ft_exp_not_zero","vt_incomplete_empty"],
        title:"Expiração incompleta / auto-PEEP provável",
        conf:"Alta",
        phys:"Fluxo expiratório não zera e volume não retorna ao baseline sugerem aprisionamento.",
        hypos:["Obstrução + FR alta","Te insuficiente","Drive elevado"],
        limits:"Quantificação formal melhora precisão."
      },
      {
        whenAny:["vt_leak","pt_sawtooth"],
        title:"Vazamento/artefato possível",
        conf:"Baixa–Média",
        phys:"Discrepância de volumes e serrilhado podem ocorrer por leak/condensado/secreção.",
        hypos:["Leak cuff/interface","Condensado","Secreção"],
        limits:"Confirmar com alarmes/inspeção."
      }
    ];

    function runMecMotor(){
      const ctx = document.getElementById("mecContext").value;
      const picked = [...document.querySelectorAll("input.mec:checked")].map(x=>x.value);

      if(picked.length===0){
        document.getElementById("mecOut").textContent = "Selecione ao menos 1 achado e rode novamente.";
        return;
      }

      let hits = MEC_RULES.filter(r => r.whenAny.some(w => picked.includes(w)));

      let lines = [];
      lines.push(`Contexto: ${ctx ? ctx : "não informado"}`);
      lines.push(`Achados selecionados: ${picked.join(", ")}`);
      lines.push("");

      hits.forEach((r, idx) => {
        lines.push(`(${idx+1}) ${r.title} — Confiança: ${r.conf}`);
        lines.push(`Fisiologia: ${r.phys}`);
        lines.push(`Hipóteses:\n${r.hypos.map(x=>"- "+x).join("\n")}`);
        lines.push(`Limites: ${r.limits}`);
        lines.push("");
      });

      document.getElementById("mecOut").textContent = lines.join("\n");
    }

    function resetChecks(which){
      const cls = which === "assin" ? "assin" : "mec";
      document.querySelectorAll(`input.${cls}`).forEach(x=> x.checked = false);
      if(which==="assin") document.getElementById("assinOut").textContent = "Selecione achados e clique em “Rodar motor”.";
      if(which==="mec") document.getElementById("mecOut").textContent = "Selecione achados e clique em “Rodar motor”.";
    }

    renderCase();
  </script>
</body>
</html>
