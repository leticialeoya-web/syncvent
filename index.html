<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Ventilação Mecânica — Assincronias | Mecânica | Curvas | Referências</title>

<style>
  :root{
    --bg:#ffffff;
    --fg:#111827;
    --muted:#6b7280;
    --line:#e5e7eb;
    --card:#f9fafb;
    --chip:#ffffff;
    --accent:#111827;

    --warn:#991b1b;
    --warnbg:#fff1f2;
    --ok:#166534;
    --okbg:#f0fdf4;
    --mid:#92400e;
    --midbg:#fffbeb;

    --radius: 14px;
    --shadow: 0 10px 30px rgba(0,0,0,.08);
  }

  *{ box-sizing:border-box; }
  body{
    margin:0; padding:16px;
    font-family: Arial, sans-serif;
    background:var(--bg); color:var(--fg);
  }
  .wrap{ max-width: 1040px; margin:0 auto; }

  h1{ font-size:20px; margin:0 0 8px; }
  h2{ font-size:16px; margin:18px 0 8px; }
  p{ margin:0 0 10px; line-height:1.45; color:#374151; }
  a{ color:var(--fg); }
  .muted{ color:var(--muted); font-size:12px; }
  .hr{ height:1px; background:var(--line); margin:12px 0; }

  .legal{
    max-width:1040px;
    margin:10px auto 14px;
    padding:8px 12px;
    border:1px solid var(--line);
    border-radius:10px;
    font-size:12px;
    color:#374151;
    background:var(--card);
  }

  .topbar{
    position:sticky; top:0; z-index:40;
    background:var(--bg);
    border-bottom:1px solid var(--line);
    padding:10px 0 12px;
    margin:0 0 12px;
  }
  .tabs{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
  .tabbtn{
    padding:10px 12px; font-size:14px; cursor:pointer;
    border:1px solid var(--line); background:#fff; border-radius:12px;
  }
  .tabbtn.active{ border-color:var(--accent); box-shadow:0 0 0 1px var(--accent) inset; }

  .card{
    border:1px solid var(--line);
    border-radius:var(--radius);
    padding:14px;
    margin:12px 0;
    background:var(--card);
  }

  .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
  .grid{ display:grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap:10px; }

  .pill{
    display:inline-block; font-size:12px; padding:3px 8px;
    border:1px solid var(--line); border-radius:999px;
    background:var(--chip); color:#4b5563; margin-left:8px;
  }

  select, input[type="number"], input[type="text"]{
    margin-top:6px; font-size:14px; padding:9px;
    border:1px solid #d1d5db; border-radius:12px; background:#fff; width:100%;
  }
  input[type="number"]{ max-width:240px; }

  button{
    padding:10px 14px; font-size:15px; cursor:pointer;
    border:1px solid #d1d5db; background:#fff; border-radius:12px;
  }
  button.primary{ border-color:var(--accent); box-shadow:0 0 0 1px var(--accent) inset; }
  button:active{ transform:translateY(1px); }

  .tag{
    display:inline-block; font-size:12px; padding:2px 8px;
    border-radius:999px; border:1px solid var(--line); background:#fff; color:#374151;
    margin-left:6px;
  }
  .tag.good{ border-color:#bbf7d0; background:var(--okbg); color:var(--ok); }
  .tag.mid { border-color:#fde68a; background:var(--midbg); color:var(--mid); }
  .tag.low { border-color:#fecaca; background:var(--warnbg); color:var(--warn); }

  .controls{
    margin-top:10px; padding-top:10px; border-top:1px dashed #d1d5db;
    display:none;
  }
  .controls.show{ display:block; }

  .resultado{ margin-top:14px; font-weight:700; }
  .debug{
    margin-top:14px;
    font-size:12px;
    color:var(--warn);
    background:var(--warnbg);
    border:1px solid #fecdd3;
    padding:10px;
    border-radius:12px;
    display:none;
    white-space:pre-wrap;
  }

  details{
    background:#fff; border:1px solid var(--line);
    border-radius:var(--radius);
    padding:10px 12px;
  }
  details + details{ margin-top:10px; }
  summary{ cursor:pointer; font-weight:700; }
  .links{ margin-top:8px; }
  .links a{ display:inline-block; margin:6px 10px 0 0; }

  .term-list{ margin-top:8px; padding-left:18px; }
  .term-list li{ margin:6px 0; }
  .term-list code{
    font-size:14px; padding:4px 6px; background:#e5e7eb; border-radius:8px; user-select:all;
  }

  footer{
    margin:28px 0 6px;
    padding-top:14px;
    border-top:1px solid var(--line);
    font-size:12px;
    color:#4b5563;
    line-height:1.55;
  }

  /* Dock mobile */
  .mobileDock{
    position:fixed; left:0; right:0; bottom:0; z-index:50;
    padding:10px 12px;
    background:rgba(255,255,255,.94);
    border-top:1px solid var(--line);
    display:none;
    backdrop-filter: blur(6px);
  }
  .mobileDock .dockInner{
    max-width: 1040px; margin:0 auto;
    display:flex; gap:10px; align-items:center; justify-content:space-between;
  }
  .mobileDock .dockBtn{
    width:100%;
    border-color: var(--accent);
    box-shadow:0 0 0 1px var(--accent) inset;
  }
  @media (max-width: 820px){
    body{ padding-bottom:78px; }
    .mobileDock{ display:block; }
  }

  /* === Mecânica: radios/choices (estilo compatível, claro) === */
  .m_radioRow{ display:flex; gap:10px; flex-wrap:wrap; }
  .m_radioBtn{
    display:inline-flex; align-items:center; gap:8px;
    border:1px solid var(--line);
    background:#fff;
    padding:10px 12px;
    border-radius:12px;
    cursor:pointer;
    font-weight:700;
    font-size:13px;
    user-select:none;
  }
  .m_radioBtn.active{
    border-color: var(--accent);
    box-shadow:0 0 0 1px var(--accent) inset;
  }
  .m_note{
    border:1px solid #fde68a;
    background: var(--midbg);
    color:#111827;
    padding:10px 12px;
    border-radius:12px;
    font-size:12.6px;
    line-height:1.35;
  }
  .m_note.danger{
    border-color:#fecaca;
    background: var(--warnbg);
    color: var(--warn);
  }
  .m_choices{ display:grid; gap:8px; margin-top:8px; }
  .m_choice{
    display:flex; gap:10px; align-items:flex-start;
    padding:10px;
    border-radius:12px;
    border:1px solid var(--line);
    background:#fff;
  }
  .m_choice input{ margin-top:2px; }
  .m_choice label{ font-weight:700; font-size:13px; }
  .m_box{
    border:1px solid var(--line);
    background:#fff;
    border-radius:12px;
    padding:10px 12px;
    margin-top:8px;
  }
  .hidden{ display:none !important; }
</style>
</head>

<body>
  <div class="legal">
    <strong>Aviso legal:</strong>
    Este material é protegido pela Lei de Direitos Autorais (Lei nº 9.610/98).
    Uso exclusivamente educacional.
    É proibida qualquer reprodução, adaptação, redistribuição ou uso comercial,
    total ou parcial, sem autorização expressa da autora.
  </div>

  <div class="wrap">
    <div class="topbar" aria-label="Navegação">
      <div class="tabs">
        <button id="tabSiteAsync" class="tabbtn active" type="button">Assincronias</button>
        <button id="tabSiteMech" class="tabbtn" type="button">Mecânica</button>
        <button id="tabSiteNorm" class="tabbtn" type="button">Curvas normais</button>
        <button id="tabSiteRefs" class="tabbtn" type="button">Manuais & Referências</button>
        <span class="muted">Educacional. Não substitui julgamento clínico. Sem orientação de conduta.</span>
      </div>
    </div>

    <!-- ====================== SITE: ASSINCRONIAS ====================== -->
    <section id="secSiteAsync">
      <div class="topbar" style="position:static; border:0; margin:0; padding:0;">
        <div class="tabs">
          <button id="a_tabEss" class="tabbtn active" type="button">Essencial</button>
          <button id="a_tabAv" class="tabbtn" type="button">Avançado</button>
        </div>
      </div>

      <!-- ESSENCIAL -->
      <section id="a_secEss">
        <h1>Essencial – Assincronias Ventilatórias</h1>
        <p class="muted">
          Apoio educacional à leitura de curvas ventilatórias (pressão, fluxo, volume). Este app organiza sinais e interpretações possíveis.
          Não substitui julgamento clínico, avaliação individual ou protocolos institucionais.
        </p>

        <div class="card">
          <h2>Esforço inefetivo</h2>
          <p><b>O que aparece</b><br>Esforço do paciente sem disparo do ventilador.</p>
          <p><b>Leitura educacional</b><br>Descompasso na fase de disparo (trigger), com associação frequente a carga inspiratória elevada (ex.: auto-PEEP) e/ou limiar de detecção.</p>
          <p><b>Pistas nas curvas</b><br>Deflexões de fluxo/pressão na expiração sem ciclo e sem volume correspondente.</p>
        </div>

        <div class="card">
          <h2>Duplo disparo</h2>
          <p><b>O que aparece</b><br>Dois ciclos consecutivos com expiração mínima entre eles.</p>
          <p><b>Leitura educacional</b><br>Persistência do esforço neural além do término do primeiro ciclo; pode coexistir com ciclagem precoce e/ou demanda inspiratória não acompanhada.</p>
          <p><b>Pistas nas curvas</b><br>Dois disparos com “empilhamento” e expiração incompleta entre ciclos.</p>
        </div>

        <div class="card">
          <h2>Disparo reverso (reverse triggering)</h2>
          <p><b>O que aparece</b><br>Esforço do paciente após o início de um ciclo mandatório.</p>
          <p><b>Leitura educacional</b><br>Entrainment (acoplamento) entre ciclos mandatórios e esforço tardio.</p>
          <p><b>Pistas nas curvas</b><br>Relação temporal repetitiva entre ciclo mandatório e sinais de esforço no meio/fim da inspiração.</p>
        </div>

        <div class="card">
          <h2>Ciclagem precoce</h2>
          <p><b>O que aparece</b><br>Inspiração termina com fluxo ainda positivo.</p>
          <p><b>Leitura educacional</b><br>Tempo mecânico inspiratório menor que o tempo neural.</p>
          <p><b>Pistas nas curvas</b><br>Sinais de esforço persistente no fim da inspiração; pode coexistir com duplo disparo.</p>
        </div>

        <div class="card">
          <h2>Ciclagem tardia</h2>
          <p><b>O que aparece</b><br>Inspiração mantém-se apesar de fluxo ~zero.</p>
          <p><b>Leitura educacional</b><br>Tempo mecânico inspiratório maior que o tempo neural.</p>
          <p><b>Pistas nas curvas</b><br>Tentativa expiratória durante a inspiração; volume estabiliza cedo apesar de inspiração prolongada.</p>
        </div>

        <div class="card">
          <h2>Auto-PEEP (PEEP intrínseca)</h2>
          <p><b>O que aparece</b><br>Expiração não completa antes do ciclo seguinte.</p>
          <p><b>Leitura educacional</b><br>Hiperinsuflação dinâmica/aprisionamento aéreo pode coexistir com maior carga de disparo e com assincronias.</p>
          <p><b>Pistas nas curvas</b><br>Fluxo expiratório não retorna a zero; baseline de pressão pode permanecer elevado.</p>
        </div>

        <div class="card">
          <p><b>Escopo e limites</b><br>
            Este aplicativo é exclusivamente educacional: organiza a leitura de sinais em curvas ventilatórias e apresenta interpretações possíveis.
            Não substitui julgamento clínico, avaliação individual, ou protocolos institucionais.
          </p>
        </div>
      </section>

      <!-- AVANÇADO -->
      <section id="a_secAv" style="display:none;">
        <h1>Avançado – Entrada mínima e análise gerada</h1>
        <p class="muted">
          Selecione o <b>tipo de ciclo</b> (obrigatório), o <b>modo</b> (opcional) e os <b>achados</b>.
          Saída educacional (“Teste clínico – Assincronias Ventilatórias”). Sem orientação de conduta.
        </p>

        <div class="card">
          <label>Tipo de ciclo <span class="pill">Obrigatório</span></label>
          <div class="row" style="margin-top:8px;">
            <label><input type="radio" name="a_tipoCiclo" value="mandatorio"> Mandatório (a tempo)</label>
            <label><input type="radio" name="a_tipoCiclo" value="assistido"> Assistido (disparado pelo paciente)</label>
            <label><input type="radio" name="a_tipoCiclo" value="misto"> Misto</label>
          </div>

          <div style="margin-top:12px;">
            <div class="muted">Modo ventilatório (opcional)</div>
            <select id="a_modoVent">
              <option value="nao_informado">Não informado</option>
              <option value="VCV">VCV (volume control)</option>
              <option value="PCV">PCV (pressure control)</option>
              <option value="PSV">PSV (pressure support)</option>
              <option value="PRVC">PRVC / VAPS (híbridos)</option>
            </select>
          </div>

          <div class="muted" style="margin-top:12px;">Parâmetros opcionais (contexto; não são instruções)</div>
          <div class="grid">
            <div><div class="muted">Ti (s)</div><input id="a_p_ti" type="number" step="0.01" min="0" placeholder="ex.: 0,80" /></div>
            <div><div class="muted">Rise/pressurização</div><input id="a_p_rise" type="text" placeholder="ex.: 0,2 s / médio" /></div>
            <div><div class="muted">Trigger</div><input id="a_p_trigger" type="text" placeholder="ex.: -2 cmH2O / 2 L/min" /></div>
            <div><div class="muted">% ciclagem (PSV)</div><input id="a_p_ciclagem" type="number" step="1" min="0" max="100" placeholder="ex.: 30" /></div>
            <div><div class="muted">FR (rpm)</div><input id="a_p_fr" type="number" step="1" min="0" placeholder="ex.: 16" /></div>
            <div><div class="muted">VT (mL)</div><input id="a_p_vt" type="number" step="10" min="0" placeholder="ex.: 450" /></div>
            <div><div class="muted">PEEP (cmH2O)</div><input id="a_p_peep" type="number" step="1" min="0" placeholder="ex.: 8" /></div>
            <div><div class="muted">Auto-PEEP / PEEPi (cmH2O)</div><input id="a_p_peepi" type="number" step="1" min="0" placeholder="ex.: 10" /></div>
          </div>
        </div>

        <div class="card">
          <label>Achados (marque o que você vê) <span class="pill">Entrada</span></label>

          <div class="grid" style="margin-top:10px;">
            <div>
              <label><input type="checkbox" id="a_expNaoZera"> Expiração não zera antes do próximo ciclo <span class="pill">Fluxo</span></label>
              <div class="muted">Sinal associado a hiperinsuflação dinâmica/auto-PEEP.</div>
            </div>

            <div>
              <label><input type="checkbox" id="a_ciclagemPrecoce"> Ciclagem precoce <span class="pill">Fluxo</span></label>
              <div class="muted">Inspiração termina com fluxo ainda positivo.</div>
            </div>

            <div>
              <label><input type="checkbox" id="a_ciclagemTardia"> Ciclagem tardia <span class="pill">Fluxo</span></label>
              <div class="muted">Inspiração persiste com fluxo ~0.</div>
            </div>

            <div>
              <label><input type="checkbox" id="a_duploDisparo"> Duplo disparo <span class="pill">Padrão</span></label>
              <div class="muted">Dois ciclos consecutivos com expiração mínima entre eles (empilhamento).</div>
            </div>

            <div>
              <label><input type="checkbox" id="a_rt"> Reverse Triggering (suspeita) <span class="pill">Padrão</span></label>
              <div class="muted">Ciclo mandatório + esforço tardio repetitivo (acoplamento).</div>
            </div>
          </div>

          <div class="row" style="margin-top:14px;">
            <button id="a_btnRodar" class="primary" type="button">Rodar análise</button>
            <button id="a_btnCopiar" type="button" disabled>Copiar texto</button>
          </div>

          <div class="resultado" id="a_resultado"></div>
          <div class="debug" id="a_debug"></div>
        </div>

        <div class="card" id="a_cardSaida" style="display:none;">
          <label>Saída gerada <span class="pill">Texto</span></label>
          <div id="a_saida"></div>
        </div>
      </section>
    </section>

    <!-- ====================== SITE: MECÂNICA ====================== -->
    <section id="secSiteMech" style="display:none;">
      <h1>Mecânica Respiratória — Curvas Ventilatórias (Educacional)</h1>
      <p class="muted">Leitura por sinais observáveis em curvas temporais. Sem loops. Sem orientação de conduta.</p>

      <div class="topbar" style="position:static; border:0; margin:0; padding:0;">
        <div class="tabs">
          <button id="m_tabEss" class="tabbtn active" type="button">Aba 1 — Essencial</button>
          <button id="m_tabAv" class="tabbtn" type="button">Aba 2 — Avançado</button>
          <button id="m_tabMet" class="tabbtn" type="button">Aba 3 — Método e Limites</button>
        </div>
      </div>

      <!-- Mecânica: Essencial -->
      <section id="m_secEss">
        <div class="grid">
          <div class="card">
            <h2>1) Selecione a curva</h2>
            <div class="muted">Escolha uma curva temporal para organizar sinais observáveis.</div>
            <div class="hr"></div>

            <div class="m_radioRow" id="m_ess_curveBtns">
              <div class="m_radioBtn" data-group="m_ess_curve" data-value="pressao">Pressão × Tempo</div>
              <div class="m_radioBtn" data-group="m_ess_curve" data-value="fluxo">Fluxo × Tempo</div>
              <div class="m_radioBtn" data-group="m_ess_curve" data-value="volume">Volume × Tempo</div>
            </div>

            <div class="hr"></div>

            <h2>2) Selecione a fase</h2>
            <div class="muted">As opções mudam conforme a curva.</div>
            <div class="m_radioRow" id="m_ess_phaseBtns"></div>

            <div class="hr"></div>

            <div id="m_ess_hint" class="m_note hidden"></div>

            <div class="row" style="margin-top:12px;">
              <button class="primary" id="m_btnEssGerar" type="button">Gerar leitura</button>
              <button id="m_btnEssLimpar" type="button">Limpar</button>
            </div>
          </div>

          <div class="card">
            <h2>3) Marque os sinais observados</h2>
            <div class="muted">Marque 1–3 sinais (lista curta).</div>
            <div class="hr"></div>
            <div id="m_ess_signalsWrap"><div class="m_note">Selecione uma curva e fase para exibir os sinais.</div></div>

            <div class="hr"></div>

            <h2>Resultado</h2>
            <div class="muted">A saída aparece após “Gerar leitura”.</div>

            <div class="m_box hidden" id="m_ess_outBox">
              <h3 style="margin:0 0 8px; font-size:13.5px;">O que se observa</h3>
              <div id="m_ess_obs" class="muted"></div>
              <div class="hr"></div>

              <h3 style="margin:0 0 8px; font-size:13.5px;">O que isso pode indicar</h3>
              <div id="m_ess_read" class="muted"></div>
              <div class="hr"></div>

              <h3 style="margin:0 0 8px; font-size:13.5px;">Limites da interpretação</h3>
              <div id="m_ess_limits" class="muted"></div>
              <div class="hr"></div>

              <div class="row">
                <button id="m_btnEssCopiar" type="button">Copiar resultado</button>
              </div>
              <div id="m_ess_copyMsg" class="muted" style="margin-top:8px;"></div>
            </div>
          </div>
        </div>
      </section>

      <!-- Mecânica: Avançado -->
      <section id="m_secAv" class="hidden">
        <div class="grid">
          <div class="card">
            <h2>Entrada (Avançado)</h2>
            <div class="muted">
              Selecione curva, fase e marque sinais. O motor prioriza fases e pode listar alternativas. Sem orientação de conduta.
            </div>

            <div class="hr"></div>

            <div class="muted" style="margin-bottom:6px;">Curva</div>
            <div class="m_radioRow" id="m_av_curveBtns">
              <div class="m_radioBtn" data-group="m_av_curve" data-value="pressao">Pressão × Tempo</div>
              <div class="m_radioBtn" data-group="m_av_curve" data-value="fluxo">Fluxo × Tempo</div>
              <div class="m_radioBtn" data-group="m_av_curve" data-value="volume">Volume × Tempo</div>
            </div>

            <div class="hr"></div>

            <div class="muted" style="margin-bottom:6px;">Fase</div>
            <div class="m_radioRow" id="m_av_phaseBtns"></div>

            <div class="hr"></div>

            <div class="muted" style="margin-bottom:6px;">Ciclo a ciclo (opcional)</div>
            <div class="m_radioRow" id="m_av_regBtns">
              <div class="m_radioBtn" data-group="m_av_reg" data-value="consistente">Consistente</div>
              <div class="m_radioBtn" data-group="m_av_reg" data-value="variavel">Variável</div>
            </div>

            <div class="hr"></div>

            <div id="m_av_hint" class="m_note hidden"></div>

            <div class="row" style="margin-top:12px;">
              <button class="primary" id="m_btnAvGerar" type="button">Gerar leitura</button>
              <button id="m_btnAvLimpar" type="button">Limpar</button>
            </div>
          </div>

          <div class="card">
            <h2>Sinais (Avançado)</h2>
            <div class="muted">Lista completa por curva e fase.</div>
            <div class="hr"></div>
            <div id="m_av_signalsWrap"><div class="m_note">Selecione curva e fase para exibir sinais.</div></div>

            <div class="hr"></div>

            <h2>Resultado (Avançado)</h2>
            <div class="muted">Leitura principal + alternativas e limites (gerais e específicos).</div>

            <div class="m_box hidden" id="m_av_outBox">
              <h3 style="margin:0 0 8px; font-size:13.5px;">O que se observa</h3>
              <div id="m_av_obs" class="muted"></div>
              <div class="hr"></div>

              <h3 style="margin:0 0 8px; font-size:13.5px;">O que isso pode indicar</h3>
              <div id="m_av_read" class="muted" style="white-space:pre-line;"></div>
              <div class="hr"></div>

              <h3 style="margin:0 0 8px; font-size:13.5px;">Limites da interpretação</h3>
              <div id="m_av_limits_short" class="muted"></div>

              <details style="margin-top:10px;">
                <summary>Ver limites completos</summary>
                <div id="m_av_limits" class="muted" style="margin-top:8px; white-space:pre-line;"></div>
              </details>

              <div class="hr"></div>

              <div class="row">
                <button id="m_btnAvCopiar" type="button">Copiar resultado</button>
              </div>
              <div id="m_av_copyMsg" class="muted" style="margin-top:8px;"></div>
            </div>
          </div>
        </div>
      </section>

      <!-- Mecânica: Método -->
      <section id="m_secMet" class="hidden">
        <div class="grid">
          <div class="card">
            <h2>Como usar</h2>
            <ol class="muted" style="margin:8px 0 0 18px;">
              <li>Selecione a curva (Pressão×Tempo, Fluxo×Tempo ou Volume×Tempo).</li>
              <li>Selecione a fase e marque sinais observados.</li>
              <li>Gere a leitura: observação objetiva → leitura mecânica possível → limites interpretativos.</li>
            </ol>
          </div>

          <div class="card">
            <h2>Sobre o método</h2>
            <details>
              <summary>Princípios (versão sem loops)</summary>
              <div class="muted" style="margin-top:10px;">
                <ul>
                  <li>Baseado em sinais observáveis em curvas temporais (pressão×tempo, fluxo×tempo, volume×tempo).</li>
                  <li>Não utiliza loops (Pressão–Volume / Fluxo–Volume) nesta versão.</li>
                  <li>Saída padronizada: observação objetiva → leitura mecânica possível → limites interpretativos.</li>
                  <li>Sem diagnóstico, sem orientação de conduta e sem sugestão de ajustes ventilatórios.</li>
                </ul>
              </div>
            </details>

            <div class="hr"></div>

            <h2>Limites gerais (sempre aplicáveis)</h2>
            <div class="muted" id="m_met_limitesGerais"></div>

            <div class="hr"></div>

            <h2>O que o app não faz</h2>
            <div class="muted">
              <ul>
                <li>Não sugere ajustes de ventilador.</li>
                <li>Não define etiologia (pulmão, via aérea, parede torácica, circuito).</li>
                <li>Não estima gravidade clínica, prognóstico ou resposta terapêutica.</li>
                <li>Não substitui correlação clínica, dados numéricos, exames ou monitorização contínua.</li>
              </ul>
            </div>
          </div>

          <div class="card">
            <h2>Autoria e uso</h2>
            <div class="muted">Conteúdo educacional. Autoria e estrutura protegidas. Uso comercial não autorizado.</div>
          </div>
        </div>
      </section>
    </section>

    <!-- ====================== SITE: CURVAS NORMAIS ====================== -->
    <section id="secSiteNorm" style="display:none;">
      <h1>Curvas normais</h1>
      <p class="muted">Imagens PNG na raiz do repositório: <code>grafico_pcv.png</code> e <code>grafico_vcv.png</code>.</p>

      <div class="card">
        <h2>PCV (Pressão Controlada) — Volume, Fluxo e Pressão</h2>
        <div class="hr"></div>
        <img src="grafico_pcv.png" alt="Gráfico PCV" style="width:100%; height:auto; border:1px solid var(--line); border-radius:12px; background:#fff;" />
      </div>

      <div class="card">
        <h2>VCV (Volume Controlado) — Volume, Fluxo e Pressão</h2>
        <div class="hr"></div>
        <img src="grafico_vcv.png" alt="Gráfico VCV" style="width:100%; height:auto; border:1px solid var(--line); border-radius:12px; background:#fff;" />
      </div>

      <div class="card">
        <h2>Escopo e limites</h2>
        <p class="muted">Conteúdo educacional. Não substitui julgamento clínico. Não orienta ajustes ventilatórios.</p>
      </div>
    </section>

    <!-- ====================== SITE: MANUAIS & REFERÊNCIAS ====================== -->
    <section id="secSiteRefs" style="display:none;">
      <h1>Manuais & Referências</h1>
      <p class="muted">Seção compartilhada. Você pode colar aqui o bloco completo que já tinha.</p>

      <div class="card">
        <h2>1) Termos para procurar no manual (copiar e colar)</h2>
        <ul class="term-list">
          <li><code>trigger</code> / <code>sensitivity</code></li>
          <li><code>flow trigger</code> / <code>pressure trigger</code></li>
          <li><code>cycling</code> / <code>cycle off</code> / <code>flow termination</code></li>
          <li><code>rise time</code> / <code>pressurization</code></li>
          <li><code>inspiratory time</code> / <code>Ti</code> / <code>expiratory time</code></li>
          <li><code>leak</code> / <code>leak compensation</code></li>
          <li><code>bias flow</code> / <code>intrinsic PEEP</code></li>
          <li><code>mandatory breath</code> / <code>spontaneous breath</code></li>
          <li><code>asynchrony</code> / <code>reverse triggering</code></li>
        </ul>

        <div class="hr"></div>

        <h2>2) iPhone: “Buscar na Página” dentro do PDF</h2>
        <div style="color:#374151; line-height:1.45;">
          1) Abrir o PDF (Safari/Arquivos).<br>
          2) Tocar em <b>Compartilhar</b>.<br>
          3) Selecionar <b>Buscar na Página</b> (ou “Localizar na Página”).<br>
          4) Colar um termo da lista acima.<br>
          5) Navegar pelas ocorrências.
        </div>
      </div>
    </section>

    <footer>
      <p><b>Autoria:</b> Leticia Moreira. © 2026.</p>
      <p>
        <b>Escopo:</b> educacional. Conteúdo destinado a organizar sinais e interpretações possíveis a partir de curvas ventilatórias.
        Não substitui julgamento clínico, avaliação individual ou protocolos institucionais.
      </p>
      <p>
        <b>Restrição:</b> uso comercial proibido sem autorização expressa. Redistribuição/incorporação em produto/serviço somente com autorização expressa.
        <b>Citação obrigatória</b> em qualquer reprodução autorizada.
      </p>
    </footer>
  </div>

  <div class="mobileDock" aria-label="Atalho Manuais & Referências">
    <div class="dockInner">
      <button id="btnDockRefs" class="dockBtn" type="button">Manuais & Referências</button>
    </div>
  </div>

<script>
(function(){
  "use strict";

  // ===== SITE TABS =====
  const siteTabs = [
    ["tabSiteAsync","secSiteAsync"],
    ["tabSiteMech","secSiteMech"],
    ["tabSiteNorm","secSiteNorm"],
    ["tabSiteRefs","secSiteRefs"],
  ];
  function showSite(secId){
    siteTabs.forEach(([btn, sec])=>{
      const b=document.getElementById(btn);
      const s=document.getElementById(sec);
      if(!b||!s) return;
      const on = (sec===secId);
      b.classList.toggle("active", on);
      s.style.display = on ? "block" : "none";
    });
    window.scrollTo(0,0);
  }
  siteTabs.forEach(([btn, sec])=>{
    const b=document.getElementById(btn);
    if(b) b.addEventListener("click", ()=>showSite(sec));
  });
  document.getElementById("btnDockRefs").addEventListener("click", ()=>{
    showSite("secSiteRefs");
    document.getElementById("secSiteRefs").scrollIntoView({behavior:"smooth", block:"start"});
  });

  // ===== ASSINCRONIAS: sub-tabs =====
  const a_tabEss = document.getElementById("a_tabEss");
  const a_tabAv  = document.getElementById("a_tabAv");
  const a_secEss = document.getElementById("a_secEss");
  const a_secAv  = document.getElementById("a_secAv");

  function showAsync(which){
    a_secEss.style.display = (which==="ess") ? "block" : "none";
    a_secAv.style.display  = (which==="av")  ? "block" : "none";
    a_tabEss.classList.toggle("active", which==="ess");
    a_tabAv.classList.toggle("active",  which==="av");
    window.scrollTo(0,0);
  }
  a_tabEss.addEventListener("click", ()=>showAsync("ess"));
  a_tabAv.addEventListener("click",  ()=>showAsync("av"));

  // ===== ASSINCRONIAS: motor simples, funcional =====
  const a_debug = document.getElementById("a_debug");
  const a_resultado = document.getElementById("a_resultado");
  const a_cardSaida = document.getElementById("a_cardSaida");
  const a_saida = document.getElementById("a_saida");
  const a_btnRodar = document.getElementById("a_btnRodar");
  const a_btnCopiar = document.getElementById("a_btnCopiar");

  function a_showError(msg){
    a_debug.style.display="block";
    a_debug.textContent=String(msg||"Erro");
  }

  function a_getTipo(){
    const el = document.querySelector('input[name="a_tipoCiclo"]:checked');
    return el ? el.value : null;
  }
  function a_tipoLabel(v){
    if(v==="mandatorio") return "Mandatório (a tempo)";
    if(v==="assistido") return "Assistido (disparado pelo paciente)";
    if(v==="misto") return "Misto";
    return "Não selecionado";
  }
  function a_fmt(x){
    const v=String(x||"").trim();
    return v ? v.replace(".",",") : "";
  }
  function a_params(){
    const ti = document.getElementById("a_p_ti").value;
    const rise = document.getElementById("a_p_rise").value.trim();
    const trig = document.getElementById("a_p_trigger").value.trim();
    const cyc = document.getElementById("a_p_ciclagem").value;
    const fr = document.getElementById("a_p_fr").value;
    const vt = document.getElementById("a_p_vt").value;
    const peep = document.getElementById("a_p_peep").value;
    const peepi = document.getElementById("a_p_peepi").value;

    const parts=[];
    if(ti) parts.push(`Ti ${a_fmt(ti)} s`);
    if(rise) parts.push(`Rise/pressurização: ${rise}`);
    if(trig) parts.push(`Trigger: ${trig}`);
    if(cyc) parts.push(`% ciclagem: ${a_fmt(cyc)}%`);
    if(fr) parts.push(`FR ${a_fmt(fr)}`);
    if(vt) parts.push(`VT ${a_fmt(vt)} mL`);
    if(peep) parts.push(`PEEP ${a_fmt(peep)} cmH2O`);
    if(peepi) parts.push(`Auto-PEEP (PEEPi) ${a_fmt(peepi)} cmH2O`);
    return parts.length ? parts.join(" | ") : "Sem parâmetros adicionais informados.";
  }

  function a_conf(level){
    if(level==="alta") return '<span class="tag good">Confiança alta</span>';
    if(level==="média") return '<span class="tag mid">Confiança média</span>';
    return '<span class="tag low">Confiança baixa</span>';
  }

  let a_lastText = "";

  a_btnRodar.addEventListener("click", ()=>{
    try{
      a_debug.style.display="none"; a_debug.textContent="";
      a_resultado.textContent="";
      a_cardSaida.style.display="none";
      a_saida.innerHTML="";
      a_btnCopiar.disabled=true;
      a_lastText="";

      const tipo = a_getTipo();
      if(!tipo){
        a_resultado.textContent="Selecione o tipo de ciclo antes de rodar a análise.";
        return;
      }

      const modo = document.getElementById("a_modoVent").value;
      const ctxCiclo = a_tipoLabel(tipo);
      const ctxModo = (modo==="nao_informado") ? "Não informado" : modo;
      const ctxParams = a_params();

      const sinais=[];
      const padroes=[];
      const hip=[];
      const vars=[];

      const expNaoZera = document.getElementById("a_expNaoZera").checked;
      const cicPrec = document.getElementById("a_ciclagemPrecoce").checked;
      const cicTard = document.getElementById("a_ciclagemTardia").checked;
      const duplo = document.getElementById("a_duploDisparo").checked;
      const rt = document.getElementById("a_rt").checked;

      if(expNaoZera){
        sinais.push("Fluxo: expiração não retorna a zero antes do próximo ciclo.");
        padroes.push(`Auto-PEEP / hiperinsuflação dinâmica ${a_conf("alta")}`);
        hip.push("Aprisionamento aéreo pode coexistir com maior carga de disparo e com esforço inefetivo.");
        vars.push("Te, FR, Ti, resistência/obstrução, vazamentos.");
      }
      if(cicPrec){
        sinais.push("Fluxo: ciclagem precoce (inspiração termina com fluxo ainda positivo).");
        padroes.push(`Ciclagem precoce ${a_conf("alta")}`);
        hip.push("Tempo mecânico inspiratório menor que o tempo neural.");
        vars.push("Critério de término/ciclagem, Ti, pressurização (modo-dependente).");
      }
      if(cicTard){
        sinais.push("Fluxo: ciclagem tardia (inspiração persiste com fluxo ~0).");
        padroes.push(`Ciclagem tardia ${a_conf("alta")}`);
        hip.push("Tempo mecânico inspiratório maior que o tempo neural.");
        vars.push("Critério de término/ciclagem, Ti, transição inspiração→expiração.");
      }
      if(duplo){
        sinais.push("Padrão: duplo disparo (dois ciclos consecutivos com expiração mínima).");
        padroes.push(`Duplo disparo ${a_conf("média")}`);
        hip.push("Persistência do esforço neural além do término do primeiro ciclo pode coexistir com este padrão (modo-dependente).");
        vars.push("Timing do ciclo, critério de término, sincronização ciclo a ciclo.");
      }
      if(rt){
        sinais.push("Padrão: suspeita de reverse triggering (ciclo mandatório + esforço tardio repetitivo).");
        padroes.push(`Reverse triggering (suspeita) ${a_conf("baixa")}`);
        hip.push("Entrainment: ciclo mandatório pode coexistir com esforço neural tardio acoplado.");
        vars.push("Tipo de ciclo mandatório, timing (Ti/FR), repetição ciclo a ciclo.");
      }

      if(sinais.length===0){
        a_resultado.textContent=`Ciclo: ${ctxCiclo} | Modo: ${ctxModo}. Nenhum achado selecionado.`;
        return;
      }

      const leitura =
        expNaoZera ? "Predomínio de sinais compatíveis com expiração incompleta/auto-PEEP, com impacto possível na sincronia global." :
        cicPrec ? "Predomínio de sinais compatíveis com ciclagem precoce (tempo mecânico inspiratório menor que o tempo neural)." :
        cicTard ? "Predomínio de sinais compatíveis com ciclagem tardia (tempo mecânico inspiratório maior que o tempo neural)." :
        rt ? "Predomínio de sinais compatíveis com reverse triggering (suspeita; critérios variam por contexto)." :
        "Sinais múltiplos selecionados. Leitura integrada depende do modo, do timing e da repetição ciclo a ciclo.";

      const html = `
        <div class="p" style="font-weight:700; font-size:14px;">Teste clínico – Assincronias Ventilatórias</div>

        <div class="muted" style="margin-top:10px;">Contexto</div>
        <div style="color:#374151; line-height:1.45;">
          <b>Ciclo:</b> ${ctxCiclo}<br>
          <b>Modo:</b> ${ctxModo}<br>
          <b>Parâmetros informados:</b> ${ctxParams}
        </div>

        <div class="muted" style="margin-top:10px;">1) Sinais selecionados</div>
        <ul>${sinais.map(s=>`<li>${s}</li>`).join("")}</ul>

        <div class="muted" style="margin-top:10px;">2) Padrões compatíveis (síntese)</div>
        <div style="color:#374151;">${padroes.map(x=>`<div>${x}</div>`).join("")}</div>

        <div class="muted" style="margin-top:10px;">3) Leitura integrada (educacional)</div>
        <div style="color:#374151;">${leitura}</div>

        <div class="muted" style="margin-top:10px;">4) Hipóteses interpretativas (educacionais)</div>
        <ul>${hip.map(h=>`<li>${h}</li>`).join("")}</ul>

        <div class="muted" style="margin-top:10px;">5) Variáveis frequentemente associadas</div>
        <ul>${vars.map(v=>`<li>${v}</li>`).join("")}</ul>

        <div class="muted" style="margin-top:10px;">Escopo e limites</div>
        <div style="color:#374151;">
          Texto gerado para fins educacionais. Não substitui julgamento clínico, avaliação individual ou protocolos institucionais.
        </div>
      `;

      a_saida.innerHTML = html;
      a_cardSaida.style.display="block";
      a_resultado.textContent="Análise concluída.";

      a_lastText = [
        "Teste clínico – Assincronias Ventilatórias",
        "",
        `Contexto: Ciclo: ${ctxCiclo} | Modo: ${ctxModo}`,
        `Parâmetros informados: ${ctxParams}`,
        "",
        "1) Sinais selecionados:",
        ...sinais.map(x=>`- ${x}`),
        "",
        "2) Padrões compatíveis (síntese):",
        ...padroes.map(x=>`- ${x.replace(/<[^>]*>/g,"")}`),
        "",
        "3) Leitura integrada (educacional):",
        leitura,
        "",
        "4) Hipóteses interpretativas (educacionais):",
        ...hip.map(x=>`- ${x}`),
        "",
        "5) Variáveis frequentemente associadas:",
        ...vars.map(x=>`- ${x}`),
        "",
        "Escopo e limites: educacional. Não substitui julgamento clínico, avaliação individual ou protocolos institucionais."
      ].join("\n");

      a_btnCopiar.disabled=false;

    }catch(e){
      a_showError("Falha ao rodar a análise: " + (e && e.message ? e.message : String(e)));
    }
  });

  a_btnCopiar.addEventListener("click", async ()=>{
    try{
      if(!a_lastText) return;
      if(navigator.clipboard && navigator.clipboard.writeText){
        await navigator.clipboard.writeText(a_lastText);
        a_btnCopiar.textContent="Copiado";
        setTimeout(()=>a_btnCopiar.textContent="Copiar texto", 1200);
        return;
      }
      const ta=document.createElement("textarea");
      ta.value=a_lastText;
      ta.style.position="fixed";
      ta.style.left="-9999px";
      document.body.appendChild(ta);
      ta.focus(); ta.select();
      document.execCommand("copy");
      document.body.removeChild(ta);
      a_btnCopiar.textContent="Copiado";
      setTimeout(()=>a_btnCopiar.textContent="Copiar texto", 1200);
    }catch(e){
      a_showError("Não foi possível copiar o texto.");
    }
  });

  // ===== MECÂNICA: dados (corrigidos e funcionais) =====
  const M_LIMITES_GERAIS = [
    "Não permite identificar etiologia (pulmão, via aérea, parede torácica, circuito).",
    "Não permite inferir gravidade clínica.",
    "Não distingue fenômeno transitório vs estrutural.",
    "Não correlaciona diretamente com trocas gasosas.",
    "Não substitui dados clínicos, numéricos ou exames complementares.",
    "Não orienta ajustes ventilatórios ou condutas."
  ];
  const M_LIMITES_CURTOS = [
    "Leitura baseada apenas na forma da curva.",
    "Não permite diagnóstico ou definição de causa.",
    "Não orienta ajustes ou condutas."
  ];
  const M_LIMITES_CURVA = {
    pressao: [
      "Não permite calcular complacência estática.",
      "Não separa componente resistivo vs elástico de forma isolada.",
      "Não permite inferir recrutamento ou sobredistensão.",
      "Não identifica nível 'adequado' de pressão.",
      "Não distingue influência de fluxo, tempo ou volume sem outras curvas."
    ],
    fluxo: [
      "Não permite diagnosticar obstrução.",
      "Não localiza segmento anatômico da resistência.",
      "Não quantifica resistência absoluta.",
      "Não infere aprisionamento aéreo isoladamente sem correlação.",
      "Não distingue demanda do sistema vs entrega do ventilador sem outras informações."
    ],
    volume: [
      "Não estima volumes pulmonares absolutos.",
      "Não identifica hiperinsuflação ou colapso por si só.",
      "Não infere segurança/eficácia de estratégia ventilatória.",
      "Não correlaciona com pressões transpulmonares.",
      "Não define adequação do volume mobilizado."
    ]
  };
  const M_LIMITES_TIPO = {
    constante_tempo: [
      "Não distingue causa pulmonar vs via aérea.",
      "Não diferencia fenômeno homogêneo vs heterogêneo.",
      "Não permite inferir reversibilidade."
    ],
    carga: [
      "Não separa causa resistiva vs elástica de forma definitiva.",
      "Não permite localizar determinantes anatômicos.",
      "Não quantifica magnitude absoluta da carga."
    ],
    estabilidade: [
      "Não garante estabilidade clínica global.",
      "Não exclui variabilidade em outros parâmetros não observados.",
      "Não substitui monitorização contínua."
    ],
    acomodacao: [
      "Não permite inferir distribuição regional.",
      "Não indica recrutamento alveolar.",
      "Não quantifica heterogeneidade."
    ]
  };

  const M_SIGNALS = [
    {id:"p_incl_igreme", curva:"pressao", fase:"inspiracao", label:"Inclinação ascendente íngreme", leitura:"Carga pressórica inicial aumentada / pressurização inicial predominante.", alt:["Componente dinâmica inicial predominante."], tipo:"carga"},
    {id:"p_incl_suave", curva:"pressao", fase:"inspiracao", label:"Inclinação ascendente suave", leitura:"Pressurização distribuída ao longo do tempo, com menor aceleração pressórica inicial.", alt:["Distribuição mais progressiva da pressão ao longo do ciclo inspiratório."], tipo:"carga"},
    {id:"p_convexa", curva:"pressao", fase:"inspiracao", label:"Curva convexa durante a inspiração", leitura:"Aumento progressivo da carga ao longo do enchimento (redução de acomodação ao longo da insuflação).", alt:["Impedância crescente ao enchimento ao longo do tempo."], tipo:"acomodacao"},
    {id:"p_concava", curva:"pressao", fase:"inspiracao", label:"Curva côncava durante a inspiração", leitura:"Acomodação progressiva durante a insuflação (crescimento pressórico que desacelera ao longo do tempo).", alt:["Maior componente inicial seguido de estabilização."], tipo:"acomodacao"},
    {id:"p_pico_precoce", curva:"pressao", fase:"inspiracao", label:"Pico de pressão precoce", leitura:"Carga concentrada no início da inspiração (componente dinâmica inicial predominante).", alt:["Pressão máxima deslocada para o início do ciclo."], tipo:"carga"},
    {id:"p_pico_tardio", curva:"pressao", fase:"inspiracao", label:"Pico de pressão tardio", leitura:"Carga crescente no final da inspiração (aumento progressivo de impedância ao enchimento).", alt:["Pressão máxima deslocada para o final do ciclo."], tipo:"carga"},
    {id:"p_plato_pres", curva:"pressao", fase:"plato", label:"Platô inspiratório presente", leitura:"Estabilidade pressórica em parte do ciclo (fase estática identificável).", alt:["Janela de estabilidade pressórica observável."], tipo:null},
    {id:"p_plato_aus", curva:"pressao", fase:"plato", label:"Platô inspiratório ausente", leitura:"Predomínio dinâmico durante toda a inspiração (leitura limitada de estabilidade pressórica).", alt:["Sem fase claramente estática na pressão."], tipo:null},

    {id:"f_insp_alto", curva:"fluxo", fase:"inspiracao", label:"Fluxo inspiratório alto", leitura:"Entrada rápida de gás (componente dinâmica predominante na fase inicial).", alt:["Aceleração/entrega de fluxo elevada no início do ciclo."], tipo:"carga"},
    {id:"f_insp_baixo", curva:"fluxo", fase:"inspiracao", label:"Fluxo inspiratório baixo", leitura:"Entrada lenta de gás (enchimento mais gradual do sistema).", alt:["Menor velocidade de enchimento."], tipo:"carga"},
    {id:"f_decl_lento", curva:"fluxo", fase:"inspiracao", label:"Declínio lento do fluxo inspiratório", leitura:"Entrada prolongada de gás (redução gradual do fluxo).", alt:["Enchimento mais prolongado."], tipo:"carga"},
    {id:"f_concava", curva:"fluxo", fase:"inspiracao", label:"Curva inspiratória côncava", leitura:"Fluxo maior no início com desaceleração posterior (acomodação progressiva).", alt:["Desaceleração do fluxo ao longo da inspiração."], tipo:"acomodacao"},
    {id:"f_exp_long", curva:"fluxo", fase:"expiracao", label:"Expiração prolongada", leitura:"Dissipação volumétrica prolongada (esvaziamento estendido).", alt:["Constante de tempo aumentada: inferência dinâmica."], tipo:"constante_tempo"},
    {id:"f_exp_baixo", curva:"fluxo", fase:"expiracao", label:"Fluxo expiratório baixo", leitura:"Esvaziamento lento (constante de tempo aumentada: inferência dinâmica).", alt:["Maior resistência dinâmica ao esvaziamento: inferência."], tipo:"constante_tempo"},
    {id:"f_nao_zero", curva:"fluxo", fase:"final", label:"Fluxo expiratório não zera", leitura:"Esvaziamento incompleto antes do próximo ciclo (inferência de volume residual ciclo a ciclo).", alt:["Acúmulo de volume residual: inferência dinâmica."], tipo:"constante_tempo"},
    {id:"f_perfil_var", curva:"fluxo", fase:"ciclo", label:"Perfil de fluxo variável entre ciclos", leitura:"Variabilidade mecânica do padrão de fluxo ao longo do tempo.", alt:["Mudança dinâmica ciclo a ciclo."], tipo:"estabilidade"},

    {id:"v_ench_rap", curva:"volume", fase:"enchimento", label:"Enchimento rápido do volume", leitura:"Enchimento volumétrico rápido (taxa de aumento volumétrico elevada).", alt:["Volume cresce rapidamente no início do ciclo."], tipo:"carga"},
    {id:"v_ench_lento", curva:"volume", fase:"enchimento", label:"Enchimento lento do volume", leitura:"Enchimento volumétrico lento (taxa de aumento volumétrico reduzida).", alt:["Volume cresce gradualmente."], tipo:"carga"},
    {id:"v_plato_precoce", curva:"volume", fase:"plato", label:"Platô volumétrico precoce", leitura:"Volume estabiliza precocemente (enchimento concentrado no início).", alt:["Estabilização precoce do volume."], tipo:"acomodacao"},
    {id:"v_plato_tardio", curva:"volume", fase:"plato", label:"Platô volumétrico tardio", leitura:"Volume estabiliza apenas no final (enchimento progressivo).", alt:["Estabilização tardia do volume."], tipo:"acomodacao"},
    {id:"v_final_const", curva:"volume", fase:"final", label:"Volume final constante", leitura:"Estabilidade do volume mobilizado (reprodutibilidade do volume final).", alt:["VT/volume final consistente (descritivo)."], tipo:"estabilidade"},
    {id:"v_final_var", curva:"volume", fase:"final", label:"Volume final variável", leitura:"Variabilidade do volume mobilizado ao longo do tempo.", alt:["Volume final não reprodutível ciclo a ciclo."], tipo:"estabilidade"},
    {id:"v_retorno_incomp", curva:"volume", fase:"final", label:"Retorno incompleto do volume à linha de base", leitura:"Esvaziamento incompleto com volume residual entre ciclos (inferência dinâmica).", alt:["Acúmulo de volume entre ciclos."], tipo:"constante_tempo"},
    {id:"v_acumulo", curva:"volume", fase:"final", label:"Volume acumulado entre ciclos", leitura:"Acúmulo progressivo de volume entre ciclos (retorno incompleto: inferência dinâmica).", alt:["Volume residual persistente."], tipo:"constante_tempo"},
  ];

  const M_PHASES = {
    pressao: [
      {key:"inspiracao", label:"Inspiração"},
      {key:"plato", label:"Platô"},
      {key:"expiracao", label:"Expiração"},
      {key:"ciclo", label:"Ciclo a ciclo"},
    ],
    fluxo: [
      {key:"inspiracao", label:"Inspiração"},
      {key:"expiracao", label:"Expiração"},
      {key:"final", label:"Final da expiração"},
      {key:"ciclo", label:"Ciclo a ciclo"},
    ],
    volume: [
      {key:"enchimento", label:"Enchimento"},
      {key:"plato", label:"Platô"},
      {key:"final", label:"Final do ciclo"},
      {key:"ciclo", label:"Ciclo a ciclo"},
    ],
  };

  const M_ESSENTIAL_IDS = new Set([
    "p_incl_igreme","p_incl_suave","p_convexa","p_concava","p_plato_pres","p_plato_aus","p_pico_precoce","p_pico_tardio",
    "f_insp_alto","f_insp_baixo","f_decl_lento","f_concava","f_exp_long","f_exp_baixo","f_nao_zero","f_perfil_var",
    "v_ench_rap","v_ench_lento","v_plato_precoce","v_plato_tardio","v_final_const","v_final_var","v_retorno_incomp","v_acumulo"
  ]);

  function m_qs(sel, root=document){ return root.querySelector(sel); }
  function m_qsa(sel, root=document){ return [...root.querySelectorAll(sel)]; }
  function m_uniq(arr){ return [...new Set(arr)]; }

  function m_setActive(btnRoot, group, value){
    m_qsa(`.m_radioBtn[data-group="${group}"]`, btnRoot).forEach(b=>{
      b.classList.toggle("active", b.dataset.value===value);
    });
  }
  function m_getActive(btnRoot, group){
    const b = m_qs(`.m_radioBtn[data-group="${group}"].active`, btnRoot);
    return b ? b.dataset.value : "";
  }

  function m_buildPhaseButtons(curvaKey, rootEl, group){
    rootEl.innerHTML = "";
    if(!curvaKey) return;
    (M_PHASES[curvaKey]||[]).forEach(p=>{
      const div = document.createElement("div");
      div.className = "m_radioBtn";
      div.dataset.group = group;
      div.dataset.value = p.key;
      div.textContent = p.label;
      rootEl.appendChild(div);
    });
  }

  function m_listSignals(curvaKey, faseKey, filterFn){
    return M_SIGNALS.filter(s=>{
      if(curvaKey && s.curva!==curvaKey) return false;
      if(faseKey && s.fase!==faseKey) return false;
      return filterFn ? filterFn(s) : true;
    });
  }

  function m_renderCheckboxList(target, signals, namespace){
    if(!signals.length){
      target.innerHTML = `<div class="m_note">Selecione curva e fase para exibir os sinais.</div>`;
      return;
    }
    const wrap = document.createElement("div");
    wrap.className = "m_choices";
    signals.forEach(s=>{
      const row = document.createElement("div");
      row.className = "m_choice";
      const id = `${namespace}_${s.id}`;
      row.innerHTML = `
        <input type="checkbox" id="${id}" data-sigid="${s.id}">
        <div><label for="${id}">${s.label}</label></div>
      `;
      wrap.appendChild(row);
    });
    target.innerHTML = "";
    target.appendChild(wrap);
  }

  function m_selectedSignalIds(root){
    return m_qsa('input[type="checkbox"][data-sigid]:checked', root).map(x=>x.dataset.sigid);
  }

  function m_phasePriority(curvaKey, faseKey){
    if(curvaKey==="fluxo"){
      if(faseKey==="final") return 1;
      if(faseKey==="expiracao") return 2;
      if(faseKey==="inspiracao") return 3;
      if(faseKey==="ciclo") return 4;
    }
    if(curvaKey==="volume"){
      if(faseKey==="final") return 1;
      if(faseKey==="plato") return 2;
      if(faseKey==="enchimento") return 3;
      if(faseKey==="ciclo") return 4;
    }
    if(curvaKey==="pressao"){
      if(faseKey==="expiracao") return 1;
      if(faseKey==="plato") return 2;
      if(faseKey==="inspiracao") return 3;
      if(faseKey==="ciclo") return 4;
    }
    return 99;
  }

  function m_formatLimits(curvaKey, tipos){
    const parts = [];
    parts.push("Limites gerais:");
    parts.push(...M_LIMITES_GERAIS.map(x=>"• "+x));
    if(curvaKey && M_LIMITES_CURVA[curvaKey]){
      parts.push("");
      parts.push("Limites específicos da curva:");
      parts.push(...M_LIMITES_CURVA[curvaKey].map(x=>"• "+x));
    }
    const t = m_uniq((tipos||[]).filter(Boolean));
    if(t.length){
      parts.push("");
      parts.push("Limites por tipo de leitura:");
      t.forEach(k=>{
        (M_LIMITES_TIPO[k]||[]).forEach(x=>parts.push("• "+x));
      });
    }
    return parts.join("\n");
  }

  function m_buildReading(curvaKey, faseKey, sigIds, mode, regOpt){
    const sigObjs = sigIds.map(id=>M_SIGNALS.find(s=>s.id===id)).filter(Boolean);
    const curvaLabel = curvaKey==="pressao" ? "Pressão × Tempo" : curvaKey==="fluxo" ? "Fluxo × Tempo" : "Volume × Tempo";
    const faseLabel = ((M_PHASES[curvaKey]||[]).find(p=>p.key===faseKey)?.label) || "(fase não selecionada)";

    const obsLines = [];
    obsLines.push(`${curvaLabel} — ${faseLabel}`);
    obsLines.push("Sinais:");
    sigObjs.forEach(s=>obsLines.push("• "+s.label));
    if(regOpt){
      obsLines.push(`Ciclo a ciclo: ${regOpt==="variavel" ? "Variável" : "Consistente"}`);
    }

    const sorted = [...sigObjs].sort((a,b)=>m_phasePriority(curvaKey, a.fase) - m_phasePriority(curvaKey, b.fase));
    const principal = sorted[0] || null;
    if(!principal){
      return { ok:false, msg:"Selecione ao menos 1 sinal observável.", obs:"", read:"", limits:"" };
    }

    const leituraLines = [];
    const tipos = [];
    leituraLines.push("Leitura principal:");
    leituraLines.push("• " + principal.leitura);
    if(principal.tipo) tipos.push(principal.tipo);

    if(mode==="av"){
      const alts = [];
      if(principal.alt && principal.alt.length) principal.alt.forEach(x=>alts.push(x));
      for(const s of sorted.slice(1)){
        if(alts.length>=2) break;
        alts.push(s.leitura);
        if(s.tipo) tipos.push(s.tipo);
      }
      const altsTrim = alts.filter(Boolean).slice(0,2);
      if(altsTrim.length){
        leituraLines.push("");
        leituraLines.push("Leituras alternativas (quando aplicável):");
        altsTrim.forEach(x=>leituraLines.push("• " + x));
      }
      if(regOpt==="variavel"){
        leituraLines.push("");
        leituraLines.push("Complemento (ciclo a ciclo):");
        leituraLines.push("• Variabilidade do padrão sugere instabilidade do comportamento mecânico ao longo do tempo.");
        tipos.push("estabilidade");
      }
    }

    const limitsFull = m_formatLimits(curvaKey, tipos);
    const limitsShort = M_LIMITES_CURTOS.map(x=>"• "+x).join("\n");

    return { ok:true, obs: obsLines.join("\n"), read: leituraLines.join("\n"), limitsFull, limitsShort };
  }

  async function m_copyText(text){
    if(navigator.clipboard && navigator.clipboard.writeText){
      await navigator.clipboard.writeText(text);
      return true;
    }
    const ta=document.createElement("textarea");
    ta.value=text;
    ta.style.position="fixed"; ta.style.left="-9999px";
    document.body.appendChild(ta);
    ta.focus(); ta.select();
    document.execCommand("copy");
    document.body.removeChild(ta);
    return true;
  }

  // ===== MECÂNICA: abas internas =====
  const m_tabEss = document.getElementById("m_tabEss");
  const m_tabAv = document.getElementById("m_tabAv");
  const m_tabMet = document.getElementById("m_tabMet");
  const m_secEss = document.getElementById("m_secEss");
  const m_secAv = document.getElementById("m_secAv");
  const m_secMet = document.getElementById("m_secMet");

  function m_show(which){
    m_secEss.classList.toggle("hidden", which!=="ess");
    m_secAv.classList.toggle("hidden", which!=="av");
    m_secMet.classList.toggle("hidden", which!=="met");
    m_tabEss.classList.toggle("active", which==="ess");
    m_tabAv.classList.toggle("active", which==="av");
    m_tabMet.classList.toggle("active", which==="met");
    window.scrollTo(0,0);
  }
  m_tabEss.addEventListener("click", ()=>m_show("ess"));
  m_tabAv.addEventListener("click", ()=>m_show("av"));
  m_tabMet.addEventListener("click", ()=>m_show("met"));

  // ===== MECÂNICA: Essencial bindings =====
  const m_ess_curveBtns = document.getElementById("m_ess_curveBtns");
  const m_ess_phaseBtns = document.getElementById("m_ess_phaseBtns");
  const m_ess_signalsWrap = document.getElementById("m_ess_signalsWrap");
  const m_ess_hint = document.getElementById("m_ess_hint");

  function m_essSetHint(text, kind){
    m_ess_hint.classList.remove("hidden","danger");
    m_ess_hint.classList.add("m_note");
    if(kind==="danger") m_ess_hint.classList.add("danger");
    m_ess_hint.textContent = text;
  }
  function m_essClearHint(){
    m_ess_hint.classList.add("hidden");
    m_ess_hint.textContent = "";
    m_ess_hint.classList.remove("danger");
  }

  m_ess_curveBtns.addEventListener("click", (e)=>{
    const btn = e.target.closest(".m_radioBtn");
    if(!btn) return;
    const curva = btn.dataset.value;
    m_setActive(m_ess_curveBtns, "m_ess_curve", curva);
    m_buildPhaseButtons(curva, m_ess_phaseBtns, "m_ess_phase");
    m_setActive(m_ess_phaseBtns, "m_ess_phase", "");
    m_ess_signalsWrap.innerHTML = `<div class="m_note">Selecione a fase para exibir os sinais essenciais.</div>`;
    m_essClearHint();
    document.getElementById("m_ess_outBox").classList.add("hidden");
    document.getElementById("m_ess_copyMsg").textContent="";
  });

  m_ess_phaseBtns.addEventListener("click", (e)=>{
    const btn = e.target.closest(".m_radioBtn");
    if(!btn) return;
    const fase = btn.dataset.value;
    m_setActive(m_ess_phaseBtns, "m_ess_phase", fase);
    const curva = m_getActive(m_ess_curveBtns, "m_ess_curve");
    const sigs = m_listSignals(curva, fase, s=>M_ESSENTIAL_IDS.has(s.id));
    m_renderCheckboxList(m_ess_signalsWrap, sigs, "m_ess");
    m_essClearHint();
  });

  document.getElementById("m_btnEssLimpar").addEventListener("click", ()=>{
    m_qsa('.m_radioBtn[data-group="m_ess_curve"]', m_ess_curveBtns).forEach(b=>b.classList.remove("active"));
    m_ess_phaseBtns.innerHTML="";
    m_ess_signalsWrap.innerHTML = `<div class="m_note">Selecione uma curva para exibir os sinais.</div>`;
    document.getElementById("m_ess_outBox").classList.add("hidden");
    document.getElementById("m_ess_copyMsg").textContent="";
    m_essClearHint();
  });

  document.getElementById("m_btnEssGerar").addEventListener("click", ()=>{
    const curva = m_getActive(m_ess_curveBtns, "m_ess_curve");
    const fase = m_getActive(m_ess_phaseBtns, "m_ess_phase");
    if(!curva){ m_essSetHint("Selecione a curva.", "danger"); return; }
    if(!fase){ m_essSetHint("Selecione a fase.", "danger"); return; }
    const ids = m_selectedSignalIds(m_ess_signalsWrap);
    if(ids.length<1){ m_essSetHint("Selecione ao menos 1 sinal observável.", "danger"); return; }
    if(ids.length>3){ m_essSetHint("Você marcou mais de 3 sinais. Para múltiplos sinais, use a aba Avançado.", ""); }
    else { m_essClearHint(); }

    const r = m_buildReading(curva, fase, ids, "ess", "");
    if(!r.ok){ m_essSetHint(r.msg, "danger"); return; }

    document.getElementById("m_ess_obs").textContent = r.obs;
    document.getElementById("m_ess_read").textContent = r.read;
    document.getElementById("m_ess_limits").textContent = r.limitsShort;
    document.getElementById("m_ess_outBox").classList.remove("hidden");
    document.getElementById("m_ess_copyMsg").textContent = "";
  });

  document.getElementById("m_btnEssCopiar").addEventListener("click", async ()=>{
    const text =
`Mecânica Respiratória — Curvas Ventilatórias (Educacional)

O que se observa
${document.getElementById("m_ess_obs").textContent}

O que isso pode indicar
${document.getElementById("m_ess_read").textContent}

Limites da interpretação
${document.getElementById("m_ess_limits").textContent}
`;
    try{
      await m_copyText(text);
      document.getElementById("m_ess_copyMsg").textContent="Copiado.";
    }catch(e){
      document.getElementById("m_ess_copyMsg").textContent="Não foi possível copiar automaticamente.";
    }
  });

  // ===== MECÂNICA: Avançado bindings =====
  const m_av_curveBtns = document.getElementById("m_av_curveBtns");
  const m_av_phaseBtns = document.getElementById("m_av_phaseBtns");
  const m_av_signalsWrap = document.getElementById("m_av_signalsWrap");
  const m_av_regBtns = document.getElementById("m_av_regBtns");
  const m_av_hint = document.getElementById("m_av_hint");

  function m_avSetHint(text, kind){
    m_av_hint.classList.remove("hidden","danger");
    m_av_hint.classList.add("m_note");
    if(kind==="danger") m_av_hint.classList.add("danger");
    m_av_hint.textContent = text;
  }
  function m_avClearHint(){
    m_av_hint.classList.add("hidden");
    m_av_hint.textContent = "";
    m_av_hint.classList.remove("danger");
  }

  m_av_curveBtns.addEventListener("click", (e)=>{
    const btn = e.target.closest(".m_radioBtn");
    if(!btn) return;
    const curva = btn.dataset.value;
    m_setActive(m_av_curveBtns, "m_av_curve", curva);
    m_buildPhaseButtons(curva, m_av_phaseBtns, "m_av_phase");
    m_setActive(m_av_phaseBtns, "m_av_phase", "");
    m_av_signalsWrap.innerHTML = `<div class="m_note">Selecione a fase para exibir os sinais.</div>`;
    m_qsa('.m_radioBtn[data-group="m_av_reg"]', m_av_regBtns).forEach(b=>b.classList.remove("active"));
    document.getElementById("m_av_outBox").classList.add("hidden");
    document.getElementById("m_av_copyMsg").textContent="";
    m_avClearHint();
  });

  m_av_phaseBtns.addEventListener("click", (e)=>{
    const btn = e.target.closest(".m_radioBtn");
    if(!btn) return;
    const fase = btn.dataset.value;
    m_setActive(m_av_phaseBtns, "m_av_phase", fase);
    const curva = m_getActive(m_av_curveBtns, "m_av_curve");
    const sigs = m_listSignals(curva, fase, null);
    m_renderCheckboxList(m_av_signalsWrap, sigs, "m_av");
    m_avClearHint();
  });

  m_av_regBtns.addEventListener("click", (e)=>{
    const btn = e.target.closest(".m_radioBtn");
    if(!btn) return;
    m_setActive(m_av_regBtns, "m_av_reg", btn.dataset.value);
  });

  document.getElementById("m_btnAvLimpar").addEventListener("click", ()=>{
    m_qsa('.m_radioBtn[data-group="m_av_curve"]', m_av_curveBtns).forEach(b=>b.classList.remove("active"));
    m_av_phaseBtns.innerHTML="";
    m_av_signalsWrap.innerHTML = `<div class="m_note">Selecione uma curva para exibir os sinais.</div>`;
    m_qsa('.m_radioBtn[data-group="m_av_reg"]', m_av_regBtns).forEach(b=>b.classList.remove("active"));
    document.getElementById("m_av_outBox").classList.add("hidden");
    document.getElementById("m_av_copyMsg").textContent="";
    m_avClearHint();
  });

  document.getElementById("m_btnAvGerar").addEventListener("click", ()=>{
    const curva = m_getActive(m_av_curveBtns, "m_av_curve");
    const fase = m_getActive(m_av_phaseBtns, "m_av_phase");
    const reg  = m_getActive(m_av_regBtns, "m_av_reg");

    if(!curva){ m_avSetHint("Selecione a curva.", "danger"); return; }
    if(!fase){ m_avSetHint("Selecione a fase.", "danger"); return; }
    const ids = m_selectedSignalIds(m_av_signalsWrap);
    if(ids.length<1){ m_avSetHint("Selecione ao menos 1 sinal observável.", "danger"); return; }
    m_avClearHint();

    const r = m_buildReading(curva, fase, ids, "av", reg);
    if(!r.ok){ m_avSetHint(r.msg, "danger"); return; }

    document.getElementById("m_av_obs").textContent = r.obs;
    document.getElementById("m_av_read").textContent = r.read;
    document.getElementById("m_av_limits_short").textContent = r.limitsShort;
    document.getElementById("m_av_limits").textContent = r.limitsFull;
    document.getElementById("m_av_outBox").classList.remove("hidden");
    document.getElementById("m_av_copyMsg").textContent="";
  });

  document.getElementById("m_btnAvCopiar").addEventListener("click", async ()=>{
    const text =
`Mecânica Respiratória — Curvas Ventilatórias (Educacional) — Avançado

O que se observa
${document.getElementById("m_av_obs").textContent}

O que isso pode indicar
${document.getElementById("m_av_read").textContent}

Limites da interpretação
${document.getElementById("m_av_limits").textContent}
`;
    try{
      await m_copyText(text);
      document.getElementById("m_av_copyMsg").textContent="Copiado.";
    }catch(e){
      document.getElementById("m_av_copyMsg").textContent="Não foi possível copiar automaticamente.";
    }
  });

  // método: preencher limites gerais
  document.getElementById("m_met_limitesGerais").innerHTML =
    "<ul>" + M_LIMITES_GERAIS.map(x=>`<li>${x}</li>`).join("") + "</ul>";

  // ===== default =====
  showSite("secSiteAsync");
  showAsync("ess");
  m_show("ess");
})();
</script>
</body>
</html>
